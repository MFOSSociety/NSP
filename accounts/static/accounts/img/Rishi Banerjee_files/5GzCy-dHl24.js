if (self.CavalryLogger) { CavalryLogger.start_js(["HTqlA"]); }

__d("FaceboxSourceConstants",[],(function(a,b,c,d,e,f){e.exports={SNOWLIFT_SUGGEST:"snowlift_suggest",SNOWLIFT_DISMISS:"photo_snowlift_unit_suggestions",PERMALINK_SUGGEST:"permalink_suggest",PERMALINK_DISMISS:"photo_permalink_suggestions",UPLOADER_SUGGEST:"uploader_suggest",UPLOADER_DISMISS:"album_uploader_suggestions"}}),null);
__d("SendAPIDialogButton",["Button"],(function(a,b,c,d,e,f){e.exports={monitor:function(a){var c=document.getElementsByName("publish")[0],d="TypeaheadBehaviors";Object.assign(window[d]||(window[d]={}),{SendAPIDialogButtonActivate:function(d){d.subscribe("select",function(){b("Button").setEnabled(c,1)}),d.subscribe("blur",function(){var d=a.getTokenValues();b("Button").setEnabled(c,d&&d.length)})}})}}}),null);
__d("LegacyMentionsInput.react",["cx","FocusListener","Bootloader","Event","Keys","React","ReactDOM","TypeaheadMetricsConfig"],(function(a,b,c,d,e,f,g){__p&&__p();var h;b("FocusListener");c=b("React").PropTypes;d=babelHelpers.inherits(a,b("React").Component);h=d&&d.prototype;function a(){__p&&__p();var a,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return c=(a=h.constructor).call.apply(a,[this].concat(e)),this.hasEnteredText=function(){return!!(this.$2&&this.$2.getValue().trim())}.bind(this),this.submitComment=function(event){__p&&__p();var a;if(event)a=event.target.value&&event.target.value.trim();else{var c=b("ReactDOM").findDOMNode(this.refs.textarea);c.value&&c.value!==c.placeholder&&(a=c.value)}a=a||"";c={visibleValue:a,encodedValue:a};this.$2&&(c.encodedValue=this.$2.getRawValue().trim());c=this.props.onEnterSubmit(c,event);c&&this.$2&&(this.$2.reset(),event&&event.preventDefault())}.bind(this),this.$3=function(event){var a=event.nativeEvent;a=b("Event").getKeyCode(a)==b("Keys").RETURN&&!b("Event").$E(a).getModifiers().any;var c=this.$2&&this.$2.getTypeahead().getView().getSelection();this.props.onEnterSubmit&&a&&!c&&this.submitComment(event)}.bind(this),this.$4=function(){this.props.onFocus&&this.props.onFocus(),this.$1(b("ReactDOM").findDOMNode(this.refs.root))}.bind(this),this.$5=function(){this.props.onBlur&&this.props.onBlur()}.bind(this),this.$1=function(a){__p&&__p();if(this.props.disableInitTextarea||this.$2||this.$6)return;this.$6=!0;b("Bootloader").loadModules(["CompactTypeaheadRenderer","ContextualTypeaheadView","InputSelection","MentionsInput","TextAreaControl","Typeahead","TypeaheadAreaCore","TypeaheadBestName","TypeaheadHoistFriends","TypeaheadMetrics","TypeaheadMetricsX","TypingDetector","UFIComments"],function(c,d,e,f,g,h,i,j,k,l,m,n,o){__p&&__p();o=b("ReactDOM").findDOMNode(this.refs.textarea);new g(o);if(this.props.onTypingStateChange){g=new n(o);g.init();g.subscribe("change",this.props.onTypingStateChange)}n={autoSelect:!0,renderer:c,causalElement:o,autoflip:this.props.autoflip};this.props.viewOptionsTypeObjects&&(n.typeObjects=this.props.viewOptionsTypeObjects);this.props.viewOptionsTypeObjectsOrder&&(n.typeObjectsOrder=this.props.viewOptionsTypeObjectsOrder);g=new h(this.props.datasource,{ctor:d,options:n},{ctor:i},b("ReactDOM").findDOMNode(this.refs.typeahead));c=[j,k];if(b("TypeaheadMetricsConfig").gkResults){d=new m({extraData:{event_name:"mention_metric_x"}});d.init(g)}n=new l({extraData:{event_name:"mentions",from_location:"comments"}});h.initNow(g,c,n);this.$2=new f(a,g,o,{hashtags:this.props.hashtags});this.$2.init({},this.props.initialData);this.props.initialData&&e.set(o,o.value.length);this.props.onPaste&&b("Event").listen(o,"paste",this.props.onPaste);this.props.onContentChange&&(this.$7=this.$2.subscribe("valueUpdate",function(a,b){a=b.value;this.props.onContentChange(a)}.bind(this)));this.$6=!1}.bind(this),"LegacyMentionsInput.react")}.bind(this),this.focus=function(){try{b("ReactDOM").findDOMNode(this.refs.textarea).focus()}catch(a){}}.bind(this),c}a.prototype.componentDidMount=function(){"use strict";this.props.initialData&&this.$1(b("ReactDOM").findDOMNode(this))};a.prototype.getText=function(){"use strict";return this.$2&&this.$2.getRawValue().trim()};a.prototype.componentWillUnmount=function(){"use strict";this.$2&&this.$7&&this.$2.unsubscribe(this.$7)};a.prototype.render=function(){"use strict";var a="textInput mentionsTextarea uiTextareaAutogrow uiTextareaNoResize UFIAddCommentInput _2xww";return b("React").createElement("div",{ref:"root",className:"uiMentionsInput textBoxContainer ReactLegacyMentionsInput _2xwx"},b("React").createElement("div",{className:"highlighter"},b("React").createElement("div",null,b("React").createElement("span",{className:"highlighterContent hidden_elem"}))),b("React").createElement("div",{ref:"typeahead",className:"uiTypeahead mentionsTypeahead"},b("React").createElement("div",{className:"wrap"},b("React").createElement("input",{type:"hidden",autoComplete:"off",className:"hiddenInput"}),b("React").createElement("div",{className:"innerWrap"},b("React").createElement("textarea",{ref:"textarea",name:"add_comment_text",className:a,title:this.props.placeholder,placeholder:this.props.placeholder,onFocus:this.$4,onBlur:this.$5,onKeyDown:this.$3})))),b("React").createElement("input",{type:"hidden",autoComplete:"off",className:"mentionsHidden",defaultValue:""}))};a.propTypes={initialData:c.object,disableInitTextarea:c.bool,placeholder:c.string,datasource:c.object,ref:c.string,viewOptionsTypeObjects:c.object,viewOptionsTypeObjectsOrder:c.array,hashtags:c.bool,autoflip:c.bool,onEnterSubmit:c.func,onFocus:c.func,onBlur:c.func,onContentChange:c.func,onTypingStateChange:c.func,onPaste:c.func};e.exports=a}),null);
__d("LitestandLinkHider",["DataStore","DOMQuery","Event","Parent","UserAgent_DEPRECATED"],(function(a,b,c,d,e,f){"use strict";__p&&__p();function g(event){var a=event.getTarget();a=b("Parent").byTag(a,"a");if(!(a instanceof HTMLAnchorElement))return;event.type==="mouseover"?(b("DataStore").set(a,"href",a.href),a.removeAttribute("href")):(a.href=b("DataStore").get(a,"href")||a.href,event.type==="mouseout"&&b("DataStore").remove(a,"href"))}var h={hideLinks:function(a){(b("UserAgent_DEPRECATED").chrome()||b("UserAgent_DEPRECATED").ie()>=9||b("UserAgent_DEPRECATED").opera())&&b("Event").listen(a,{mouseover:g,mouseout:g,mousedown:g})},removeAllHrefs:function(a,c){__p&&__p();c===void 0&&(c=null);a=b("DOMQuery").scry(a,"a");a.forEach(function(a){if(c&&c.length&&c.some(function(b){return a.hasAttribute(b)}))return;a.removeAttribute("href");a.removeAttribute("ajaxify");a.removeAttribute("rel");a.setAttribute("tabindex",0)})},removeClickable:function(a,c){h.removeAllHrefs(a);a=b("DOMQuery").scry(a,"."+c+" a");a.forEach(function(a){a.removeAttribute("onclick"),a.removeAttribute("onmouseover")})}};e.exports=h}),null);
__d("Overlay",["CSS","DataStore","DOM","Layer","LayerButtons","LayerDestroyOnHide","LayerFadeOnHide","LayerFadeOnShow","LayerFormHooks","LayerHideOnBlur","LayerHideOnEscape","LayerHideOnSuccess","LayerHideOnTransition","LayerMouseHooks","LayerTabIsolation"],(function(a,b,c,d,e,f){__p&&__p();var g;c=babelHelpers.inherits(a,b("Layer"));g=c&&c.prototype;function a(a,b){"use strict";a=babelHelpers["extends"]({buildWrapper:!0},a),g.constructor.call(this,a,b)}a.prototype._configure=function(a,c){"use strict";__p&&__p();this._shouldBuildWrapper=a.buildWrapper;g._configure.call(this,a,c);a=this.getRoot();if(!a)return this;this._overlay=b("DOM").scry(a,"div.uiOverlay")[0]||a;b("CSS").hide(a);b("DOM").appendContent(this.getInsertParent(),a);b("DataStore").set(this._overlay,"overlay",this);c=b("DataStore").get(this._overlay,"width");c&&this.setWidth(c);this.setFixed&&this.setFixed(b("DataStore").get(this._overlay,"fixed")=="true");b("DataStore").get(this._overlay,"fadeonshow")!="false"&&this.enableBehavior(b("LayerFadeOnShow"));b("DataStore").get(this._overlay,"fadeonhide")!="false"&&this.enableBehavior(b("LayerFadeOnHide"));b("DataStore").get(this._overlay,"hideonsuccess")!="false"&&this.enableBehavior(b("LayerHideOnSuccess"));b("DataStore").get(this._overlay,"hideonblur")=="true"&&this.enableBehavior(b("LayerHideOnBlur"));b("DataStore").get(this._overlay,"destroyonhide")!="false"&&this.enableBehavior(b("LayerDestroyOnHide"));return this};a.prototype._getDefaultBehaviors=function(){"use strict";return g._getDefaultBehaviors.call(this).concat([b("LayerButtons"),b("LayerFormHooks"),b("LayerMouseHooks"),b("LayerHideOnEscape"),b("LayerHideOnTransition"),b("LayerTabIsolation")])};a.prototype.initWithoutBuildingWrapper=function(){"use strict";this._shouldBuildWrapper=!1;return this.init.apply(this,arguments)};a.prototype._buildWrapper=function(a,c){"use strict";if(!this._shouldBuildWrapper){this._contentRoot=c;return c}this._contentRoot=b("DOM").create("div",{className:"uiOverlayContent"},c);return b("DOM").create("div",{className:"uiOverlay"},this._contentRoot)};a.prototype.getContentRoot=function(){"use strict";return this._contentRoot};a.prototype.destroy=function(){"use strict";b("DataStore").remove(this.getRoot(),"overlay"),g.destroy.call(this)};e.exports=a}),null);
__d("PhotoAlbumAudienceInput",["Arbiter","CSS","DOM","Event"],(function(a,b,c,d,e,f){__p&&__p();function a(a,c,d,e,f){"use strict";this.$1=a,c&&(this.$2=c,this.$3=d,this.$4=e,this.$5=f,b("Arbiter").subscribe("Tokenizer/init",this.$6.bind(this)),b("Event").listen(this.$4,"click",this.$7.bind(this)))}a.prototype.removeHiddenPrivacyWidget=function(){"use strict";[this.$1,this.$2,this.$5].forEach(function(a){a&&b("CSS").hasClass(a,"hidden_elem")&&b("DOM").remove(a)})};a.prototype.$7=function(){"use strict";this.$8.removeAllTokens(),this.$9(null,null)};a.prototype.$6=function(a,c){"use strict";if(this.$8||this.$3!=c.element)return;this.$8=c;this.$9(null,null);b("Arbiter").subscribe("Form/change",this.$9.bind(this))};a.prototype.$9=function(a,b){"use strict";a=this.$8.getTokens().length>0;this.$10(a)};a.prototype.$10=function(a){"use strict";b("CSS").conditionShow(this.$2,a),b("CSS").conditionShow(this.$1,!a),this.$5&&b("CSS").conditionShow(this.$5,a)};e.exports=a}),null);
__d("PhotoAlbumPlacesTypeahead",["Arbiter"],(function(a,b,c,d,e,f){__p&&__p();function g(a){"use strict";__p&&__p();if(!a)return;if(a.getCore().getHiddenValue()){var c={uid:a.getCore().getHiddenValue(),text:a.getCore().getValue()};b("Arbiter").inform("PhotoAlbumPlacesTypeahead.EXIST_PLACE",c)}a.subscribe("select",function(c,a){b("Arbiter").inform("PhotoAlbumPlacesTypeahead.SELECTED_PLACE",a.selected)}.bind(this));a.subscribe("reset",function(){a.getCore().getHiddenValue()||b("Arbiter").inform("PhotoAlbumPlacesTypeahead.RESET_PLACE")}.bind(this));a.subscribe("focus",function(){b("Arbiter").inform("PhotoAlbumPlacesTypeahead.FOCUSED")}.bind(this));this._initialized=!0}g.prototype.init=function(a){"use strict";if(this._initialized)return;g.call(this,a)};e.exports=g}),null);
__d("PersistentAlbumDataStore",["WebStorage"],(function(a,b,c,d,e,f){__p&&__p();var g="fb_album_recovery",h=7*60*60*24,i={_storageExists:!0,_initializeWebStorage:function(){var a=b("WebStorage").getLocalStorage();if(!a){i._storageExists=!1;return}a.getItem(g)||a.setItem(g,JSON.stringify({}))},_getAlbumsObject:function(){if(!i._storageExists)return{};i._initializeWebStorage();return JSON.parse(b("WebStorage").getLocalStorage().getItem(g))},_setAlbumsObject:function(a){if(!i._storageExists)return;i._initializeWebStorage();b("WebStorage").getLocalStorage().setItem(g,JSON.stringify(a))},_getLocalStorageByAlbum:function(a){return i._getAlbumsObject()[a]||i.createAlbum(a)},_setLocalStorageByAlbum:function(a,b){var c=i._getAlbumsObject();c[a]=b;i._setAlbumsObject(c)},createAlbum:function(a){var b={privacy:null,tags:{},created_at:Date.now()};i._setLocalStorageByAlbum(a,b);return b},deleteAlbum:function(a){var b=i._getAlbumsObject();delete b[a];i._setAlbumsObject(b)},getAlbumPrivacy:function(a){return i._getLocalStorageByAlbum(a).privacy},setAlbumPrivacy:function(a,b){var c=i._getLocalStorageByAlbum(a);c.privacy=b;i._setLocalStorageByAlbum(a,c)},saveTag:function(a,b,c){var d=i._getLocalStorageByAlbum(a);d.tags[b]||(d.tags[b]=[]);c.recovered=!0;d.tags[b].push(c);i._setLocalStorageByAlbum(a,d)},removeTag:function(a,b,c){var d=i._getLocalStorageByAlbum(a),e=d.tags[b]||[];for(var f=0;f<e.length;f++)if(e[f].subject===c||e[f].name===c){e.splice(f,1);break}d.tags[b]=e;i._setLocalStorageByAlbum(a,d)},getTags:function(a,b){return i._getLocalStorageByAlbum(a).tags[b]||[]},deleteExpiredAlbums:function(){var a=i._getAlbumsObject();for(var b in a){var c=a[b];Date.now()-c.created_at>h*1e3&&i.deleteAlbum(b)}}};e.exports=i}),null);
__d("XFamilyBulkTagAddAsyncController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/family/bulk_tag_save/",{subject:{type:"Int"},save_tags:{type:"String"}})}),null);
__d("PhotoTagStore",["AsyncRequest","XFamilyBulkTagAddAsyncController","isEmpty"],(function(a,b,c,d,e,f){__p&&__p();function g(){"use strict";this._tagList={},this._textTagList={},this._originalTagList={},this._dirtyPhotosByUid={},g.instance=this}g.prototype.getPhotoTags=function(a){"use strict";return this._tagList[a]||{}};g.prototype.photoHasTags=function(a){"use strict";return!b("isEmpty")(this.getPhotoTags(a))};g.prototype.clear=function(){"use strict";this._tagList={},this._textTagList={},this._originalTagList={},this._dirtyPhotosByUid={}};g.prototype.addTag=function(a,b,c,d){"use strict";a[b]=a[b]||{};var e=a[b][c]||[];e.push(d);a[b][c]=e};g.prototype.revert=function(a){"use strict";var c=this._tagList,d=this._originalTagList;for(var e in c)b("isEmpty")(d[e][a])?c[e][a]=[]:c[e][a]=d[e][a];this._dirtyPhotosByUid={}};g.prototype.hasNewTags=function(){"use strict";return!b("isEmpty")(this._tagList)||!b("isEmpty")(this._textTagList)};g.prototype.userHasDirtyTags=function(a){"use strict";return!b("isEmpty")(this._dirtyPhotosByUid[a])};g.prototype.userDirtyTagsCount=function(a){"use strict";return Object.keys(this._dirtyPhotosByUid[a]).length};g.prototype.handleTagFetch=function(a){"use strict";for(var b in a)this.loadTagInfo(b,a[b])};g.prototype.saveAlbumTagsForUser=function(a,c,d,e){__p&&__p();e===void 0&&(e=!1);var f={},g=[],h=this._dirtyPhotosByUid[a]||{};for(var i in h){h=this._tagList[i][a];if(b("isEmpty")(h)){g[g.length]=i;continue}h.forEach(function(a){f[i]={x:a.x,y:a.y}})}h={subject:a,user:c,action:"save",save_tags:f};g="/ajax/photos/album/tags.php";e&&(h={subject:a,save_tags:JSON.stringify(f)},g=b("XFamilyBulkTagAddAsyncController").getURIBuilder().getURI());new(b("AsyncRequest"))().setURI(g).setData(h).setHandler(function(a){d(a.payload)}).setAllowCrossPageTransition(!0).send();delete this._dirtyPhotosByUid[a]};g.prototype.getTagsFromList=function(a){"use strict";var b=[];for(var c in a)if(Object.prototype.hasOwnProperty.call(a,c))for(var d in a[c])Object.prototype.hasOwnProperty.call(a[c],d)&&a[c][d].forEach(function(a){return b.push(a)});return b};g.prototype.getAllTags=function(){"use strict";var a=this.getTagsFromList(this._tagList),b=this.getTagsFromList(this._textTagList);return a.concat(b)};g.prototype.removeTag=function(a,c){"use strict";__p&&__p();var d=this._tagList[a],e=this._originalTagList[a]||{};e[c]?(this._dirtyPhotosByUid[c]=this._dirtyPhotosByUid[c]||{},this._dirtyPhotosByUid[c][a]=!0):delete this._dirtyPhotosByUid[c][a];for(var f in d)if(f==c){e=this._tagList[a][f];delete this._tagList[a][f];b("isEmpty")(this._tagList[a])&&delete this._tagList[a];return e}};g.prototype.removeTextTag=function(a,c){"use strict";var d=this._textTagList[a];if(!b("isEmpty")(d[c])){d=this._textTagList[a][c];this._textTagList[a][c]=[];b("isEmpty")(this._textTagList[a])&&delete this._textTagList[a];return d}return[]};g.prototype.removeAllNewTagsOfUser=function(a){"use strict";var b=[];if(!this.userHasDirtyTags(a))return b;var c=this._dirtyPhotosByUid[a];for(var d in c)b=b.concat(this.removeTag(d,a));return b};g.prototype.removeAllTagsFromPhoto=function(a){"use strict";__p&&__p();var c=[];if(!b("isEmpty")(this._tagList[a]))for(var d in this._tagList[a]){if(!Object.prototype.hasOwnProperty.call(this._tagList[a],d))continue;c=c.concat(this.removeTag(a,d))}if(!b("isEmpty")(this._textTagList[a]))for(var e in this._textTagList[a]){if(!Object.prototype.hasOwnProperty.call(this._textTagList[a],e))continue;c=c.concat(this.removeTextTag(a,e))}return c};g.prototype.storeTag=function(a,b,c,d,e){"use strict";this.storeTagWithOptions(a,b,c,d,{can_remove:e})};g.prototype.storeTagWithOptions=function(a,b,c,d,e){"use strict";this._dirtyPhotosByUid[b]=this._dirtyPhotosByUid[b]||{};this._dirtyPhotosByUid[b][a]=!0;c={x:c,y:d};Object.assign(c,e);!b?this.addTag(this._textTagList,a,c.name,c):this.addTag(this._tagList,a,b,c)};g.prototype.loadTagInfo=function(a,b){"use strict";this._tagList[a]={};this._originalTagList[a]={};for(var c=0;c<b.length;c++){var d=b[c];this.addTag(this._tagList,a,d.subject,d);this.addTag(this._originalTagList,a,d.subject,d)}};g.getInstance=function(){"use strict";g.instance===null&&new g();return g.instance};g.instance=null;e.exports=g}),null);
__d("PhotoTagDataSourceType",[],(function(a,b,c,d,e,f){e.exports=Object.freeze({PRODUCT_ITEMS:"product_items",DEFAULT:"default"})}),null);
__d("PhotosTaggingWaterfall",["AsyncSignal"],(function(a,b,c,d,e,f){function g(a){g._queueName=a||g._queueName}Object.assign(g,{BEGIN:"begin",TAG_FACE:"tag_face",HOVER_TAG_FACE:"hover_tag_face",SHOW_SUGGEST:"show_suggest",ADD_NAME:"add_name",TAG_CONFIRMED:"tag_confirmed",FINISH:"finish",TYPE_NAME:"type_name",SELECT_NAME:"select_name",_queueName:null,sendSignal:function(a,c){new(b("AsyncSignal"))("/ajax/photos/tag_waterfall.php",{data:JSON.stringify(a)}).setHandler(c).send()}});e.exports=g}),null);
__d("PhotoTagger",["csx","ActorURI","Arbiter","AsyncRequest","AsyncResponse","CSS","DOM","DOMQuery","Event","FaceboxSourceConstants","Hovercard","Keys","LegacyMentionsInput.react","Parent","PhotosConst","PhotosTaggingWaterfall","PhotosUtils","PhotoTagDataSourceType","PhotoTagStore","QE2Logger","React","ReactDOM","Style","UFIAddCommentController","UFICentralUpdates","UFIComment.react","UFIContainer.react","URI","Vector","WWWBase","getElementPosition","removeFromArray"],(function(a,b,c,d,e,f,g){__p&&__p();function h(a,b){return(a%b+b)%b}function i(a){"use strict";this.TAG_BOX_SIZE=100,this.EPSILON=.0025,this.HUGE_FACE_THRESH=90,this.HUGE_FACE_SHRINK_FACTOR=.6,this.elemNames={6:{addTagLink:"div.fbPhotosPhotoOwnerButtons",overlayActions:"div.snowliftOverlayBar"}},this.viewer=a,this.version=a.getVersionConst(),this.datasources={},this.photoData={},this.tagRects={},this.spatialTags=[],this.isSpherical=!1,this.sphericalPhotoXY=null,this.fromSphericalFacebox=!1,this.disableSaveSpatialTag=!1,this.ajaxURIs={tagsInit:"/ajax/photos/photo/tags/tags_init.php",tagsAlbum:"/ajax/photos/photo/tags/tags_album.php",fetchDatasource:"/ajax/photos/photo/tags/fetch_datasource.php",tagAction:"/ajax/photo_tagging_ajax.php",tagWithAction:"/ajax/with_tagging_ajax.php"},this.recognizedUsers=[],this.addedSuggestions=[],this.featuredSuggestions=[],this.albumSuggestions=[],this.friendSuggestions=[],this.suggestionAlbum=-1,this.addCommentController=null,i.instances[this.version]=this}i.prototype.initSnowlift=function(a,c,d,e){"use strict";this._init(a,c,d,this.viewer.container,e),b("Arbiter").inform("PhotoSnowlift.TAGGER_READY")};i.prototype.initPermalink=function(a,b,c){"use strict";this._init(a,b,c,this.viewer.actionList)};i.prototype.initSphericalPhoto=function(a,c,d){"use strict";this._init(a,c,d,this.viewer.container),b("Arbiter").inform("PhotoTagger.SPATIAL_TAGGER_READY")};i.prototype._init=function(a,c,d,e,f){"use strict";__p&&__p();this.root=this.viewer.getRoot();this.tagger=a;this.tokenizer=c;this.ufi=f;this._qn=null;this.typeahead=c.getTypeahead();this.userId=d;this.makeProfilePicMenuContainer=e;this.faceboxes=[];this.tags=[];this.currentFacebox=null;this.currentTextbox=null;this.revokedFaceboxes=[];this.requestFaceboxNextTag=!1;this.clickState=b("DOM").find(this.root,"div.stageActions");this.newTagBox=b("DOM").find(this.clickState,"div.newTagBox");this.addTagLink=null;this.overlayActions=null;this.elemNames[this.version]&&(this.addTagLink=b("DOM").find(this.root,this.elemNames[this.version].addTagLink),this.overlayActions=b("DOM").find(this.root,this.elemNames[this.version].overlayActions));this.setupHandlers();this.hideNewTagTimer=null;this.needAlbumSuggestionsFetch=!0;this.fetchTaggingSuggestions({owner:this.photoData.owner});this.setDataSource(this.typeahead.getData());this.updateFaceboxes();this.tagAccumulating=!1;return this};i.prototype.setTagAccumulator=function(a){"use strict";this.tagAccumulating=a};i.prototype.fetchTaggingSuggestions=function(a){"use strict";__p&&__p();var c=new(b("URI"))(b("WWWBase").uri).setPath(this.ajaxURIs.tagsInit);new(b("AsyncRequest"))().setAllowCrossPageTransition(!0).setAllowCrossOrigin(!0).setURI(c).setData(a).setOption("retries",1).setHandler(function(a){a=a.getPayload();this.featuredSuggestions=a.featuredTaggees;this.friendSuggestions=a.friendTaggees;this.updateTypeaheadSuggestions()}.bind(this)).send();var d=this.typeahead.subscribe("bootstrap",function(a,b){b&&!b.bootstrapping&&(this.taggingMode&&this.updateWithSuggestions(),this.typeahead.unsubscribe(d),this.typeahead.subscribe("focus",function(){this.taggingMode&&this.updateWithSuggestions()}.bind(this)),this.typeahead.subscribe("click",function(){this.taggingMode||this.updateWithSuggestions()}.bind(this)),this.tokenizer.subscribe("removeToken",this.updateWithSuggestions.bind(this)),this.tokenizer.subscribe("addToken",this.addSuggestion.bind(this)),this.typeahead.subscribe("respond",function(a,b){this.taggingMode&&b&&!b.results.length&&this.updateWithSuggestions()}.bind(this)))}.bind(this))};i.prototype.fetchAlbumTaggingSuggestions=function(){"use strict";new(b("AsyncRequest"))().setURI(this.ajaxURIs.tagsAlbum).setData({cachedAlbum:this.suggestionAlbum,photo:this.photoData.fbid}).setOption("retries",1).setAllowCrossPageTransition(!0).setHandler(function(a){this.needAlbumSuggestionsFetch=!1;a=a.getPayload();if(a.length===0)return;this.suggestionAlbum=a.album;this.albumSuggestions=a.taggees;this.updateTypeaheadSuggestions()}.bind(this)).send()};i.prototype.resetAlbumTaggingSuggestions=function(){"use strict";this.needAlbumSuggestionsFetch=!0,this.updateTypeaheadSuggestions()};i.prototype.updateTypeaheadSuggestions=function(){"use strict";this.typeahead.getView().setSuggestions(this.addedSuggestions.concat(this.recognizedUsers,this.featuredSuggestions,this.needAlbumSuggestionsFetch?[]:this.albumSuggestions,this.friendSuggestions))};i.prototype.saveClickPosition=function(a,c){"use strict";var d=b("Vector").getElementPosition(a);a=b("Vector").getElementDimensions(a);this.clickPercentToPhoto=new(b("Vector"))((c.x-d.x)/a.x,(c.y-d.y)/a.y)};i.prototype.getCalculatedClickPosition=function(a){"use strict";var c=b("Vector").getElementPosition(a);a=b("Vector").getElementDimensions(a);return a.x===0||a.y===0?null:new(b("Vector"))(this.clickPercentToPhoto.x*a.x+c.x,this.clickPercentToPhoto.y*a.y+c.y,"document")};i.prototype.repositionTagger=function(){"use strict";if(this.clickPercentToPhoto){var a=this.viewer.getImage();a=this.getCalculatedClickPosition(a);if(!a)return;this.addTagFromClickPos(a)}};i.prototype.setupHandlers=function(){"use strict";this.handlers=[b("Event").listen(this.clickState,"click",function(a){this.isSpherical||this.addTag(a)}.bind(this))],this.addTagLink&&this.handlers.push(b("Event").listen(this.addTagLink,"click",this.checkActions.bind(this))),this.overlayActions&&this.handlers.push(b("Event").listen(this.overlayActions,"click",this.checkActions.bind(this))),this.setupAddTagHandlers(),b("Event").listen(document.documentElement,"keydown",function(event){if(!this.taggingMode)return;var a=b("Event").getKeyCode(event);a===b("Keys").ESC?this.deactivateTagging():a===b("Keys").TAB&&this.addNextTagFromFacebox(event.shiftKey?-1:1)}.bind(this)),this.subscriptions=[b("Arbiter").subscribe(this.viewer.getEventString("PAGE"),this.restartTagging.bind(this)),b("Arbiter").subscribe(this.viewer.getEventString("DATA_CHANGE"),this.setPhotoData.bind(this)),b("Arbiter").subscribe(this.viewer.getEventString("EXTRA_DATA_CHANGE"),this.setExtraData.bind(this)),b("Arbiter").subscribe(this.viewer.getEventString("CLOSE"),this.deactivateTagging.bind(this))],b("UFICentralUpdates").subscribe("update-comments",function(a,b){b.comments&&b.comments.length&&this.commentAdded(b.comments,b.payloadsource)}.bind(this)),this.tokenizer.subscribe("addToken",this.saveTag.bind(this)),this.tokenizer.subscribe("removeToken",this.removeTag.bind(this)),this.tokenizer.subscribe("markTagAsSpam",this.markTagAsSpam.bind(this))};i.prototype.setupAddTagHandlers=function(){"use strict";if(this.ufi){var a=b("DOM").scry(this.root,".tagPhotoLink");a.forEach(function(a){b("Event").listen(a,"click",this.showTaggerFromClick.bind(this))},this)}};i.prototype.updateWithSuggestions=function(a,b){"use strict";a=this.typeahead.getData().buildUids(" ",this.typeahead.getView().getSuggestions(),this.typeahead.getCore().getExclusions());if(!a.length)return;b=this.typeahead.getData().respond("",a);for(var a=0;a<b.length;a++)b[a].index=-1e3+a};i.prototype.addSuggestion=function(a,b){"use strict";a=b.info&&b.info.uid;a&&(this.addedSuggestions.unshift(a),this.updateTypeaheadSuggestions())};i.prototype.setQueueName=function(a){"use strict";this._qn=a;return this};i.prototype._sendWaterfallLogSignal=function(a){"use strict";b("PhotosTaggingWaterfall").sendSignal({qn:this._qn,source:this.viewer.getSourceString(),step:a,pid:this.photoData.pid})};i.prototype._sendFaceboxSuggestionLogSignal=function(a,c,d){"use strict";b("PhotosTaggingWaterfall").sendSignal({step:b("PhotosTaggingWaterfall").SHOW_SUGGEST,photo_owner:this.photoData.owner,tagee:a,is_first:!0,source:c,photo_id:this.photoData.fbid,facebox_id:d})};i.prototype._bumpQueueName=function(){"use strict";this._qn&&(this._qn+=1)};i.prototype.activateTagging=function(){"use strict";b("Arbiter").inform("PhotoTagger.ACTIVATE_TAGGING"),this.getDataSource()?this.dataSourceFetched(this.getDataSource()):new(b("AsyncRequest"))(this.ajaxURIs.fetchDatasource).setData({fbid:this.photoData.fbid,version:this.version,data_source_type:this.dataSourceType}).send(),this.needAlbumSuggestionsFetch&&this.fetchAlbumTaggingSuggestions()};i.prototype.restartTagging=function(){"use strict";this.hideNewTag(),this.hideTagger(),this.hideExistingTags(),this.revokedFaceboxes=[],this.setCurrentFacebox(null),this.taggingMode&&(this.requestFaceboxNextTag=!0,this.activateTagging())};i.prototype.getDataSource=function(){"use strict";return this.datasources[this.getDataSourceKey()]};i.prototype.getDataSourceKey=function(){"use strict";var a;this.photoData.ownertype=="user"&&!this.photoData.obj_id?a="friends":a=this.photoData.obj_id||this.photoData.owner;return this.dataSourceType===b("PhotoTagDataSourceType").PRODUCT_ITEMS?a+"_products":a};i.prototype.setDataSource=function(a){"use strict";this.typeahead.getData()!=a&&this.typeahead.swapData(a),this.datasources[this.getDataSourceKey()]=a};i.prototype.dataSourceFetched=function(a){"use strict";__p&&__p();b("CSS").removeClass(this.root,"productTagging");b("CSS").removeClass(this.root,"peopleTagging");var c=this.dataSourceType===b("PhotoTagDataSourceType").DEFAULT;this.taggingMode=!0;b("CSS").addClass(this.root,"taggingMode");b("CSS").addClass(this.root,c?"peopleTagging":"productTagging");this._hidePivots();b("Arbiter").inform("PhotoTagger.START_TAGGING");this._bumpQueueName();this._sendWaterfallLogSignal(b("PhotosTaggingWaterfall").BEGIN);this.setDataSource(a)};i.prototype.deactivateTagging=function(){"use strict";this.taggingMode===!0&&this._sendWaterfallLogSignal(b("PhotosTaggingWaterfall").FINISH),this.taggingMode=!1,this.hideNewTag(),this.hideTagger(),this.hideExistingTags(),this.setCurrentFacebox(null),this._showPivots(),b("CSS").removeClass(this.root,"taggingMode"),this.dataSourceType===b("PhotoTagDataSourceType").PRODUCT_ITEMS?b("CSS").removeClass(this.root,"productTagging"):b("CSS").removeClass(this.root,"peopleTagging"),b("Arbiter").inform("PhotoTagger.STOP_TAGGING")};i.prototype._hidePivots=function(){"use strict";var a=b("DOMQuery").scry(this.root,".tag");for(var c=0;c<a.length;c++)b("CSS").hide(a[c])};i.prototype._showPivots=function(){"use strict";var a=b("DOMQuery").scry(this.root,".tag");for(var c=0;c<a.length;c++)b("CSS").show(a[c])};i.prototype.checkActions=function(event){"use strict";var a=event.getTarget(),c=b("Parent").byClass(a,"fbPhotosPhotoActionsTag");a=b("Parent").byClass(a,"fbPhotosPhotoActionsProductTag");if(c||a){var d=b("CSS").hasClass(this.root,"peopleTagging"),e=b("CSS").hasClass(this.root,"productTagging");c=c&&e||a&&d;this.taggingMode&&!c?this.deactivateTagging():(this.dataSourceType=a?b("PhotoTagDataSourceType").PRODUCT_ITEMS:b("PhotoTagDataSourceType").DEFAULT,this.activateTagging(),this.isSpherical||this.addNextTagFromFacebox(1))}};i.prototype.hideTagger=function(){"use strict";b("CSS").hide(this.tagger);this.clickPercentToPhoto=null;var a=b("DOM").scry(this.tagger,"input.textInput")[0];a&&a.blur()};i.prototype.showTaggerFromClick=function(event){"use strict";__p&&__p();var a=event.getTarget();a=b("Parent").byClass(a,"tagPhotoLink");var c=a.getAttribute("data-x");a=a.getAttribute("data-y");if(c!==null&&a!==null){c=new(b("Vector"))(c,a);a=this.viewer.getImage();c=b("PhotosUtils").normalizedToAbsolutePosition(a,c);this.setClickPosAndFacebox(c);this.addTagFromClickPos(c)}this.showTagger()};i.prototype.showTagger=function(){"use strict";__p&&__p();b("QE2Logger").logExposureForUser("www_snowlift_photo_tagger_qe");b("DOM").scry(this.root,".fbPhotosPhotoTagboxBase").forEach(function(a){b("CSS").removeClass(a,"hover"),b("CSS").removeClass(a,"tagClick"),this.taggingMode&&b("CSS").hide(b("DOM").find(a,".tag"))},this);var a=b("DOM").find(this.tagger,".typeaheadContainer"),c=b("DOM").find(a,".arrow .nub"),d=3;b("Style").set(a,"margin-left",0);b("Style").set(c,"margin-left",0);var e=b("getElementPosition")(a);e.x<=0&&(b("CSS").hasClass(this.tagger,"fbPhotoTaggerFlipped")||(b("Style").set(a,"margin-left",-2*e.x+"px"),b("Style").set(c,"margin-left",e.x-d+"px")));if(this.ufi){c=b("DOM").find(this.tagger,"._12nb");b("CSS").show(a);b("CSS").hide(c)}b("CSS").show(this.tagger);setTimeout(function(){b("DOM").find(this.tagger,"input.textInput").focus()}.bind(this),0);this.hideNewTag();b("Arbiter").inform("reflow")};i.prototype.showNewTag=function(a,c){"use strict";__p&&__p();if(c&&this.ufi){b("CSS").addClass(c,"hover");b("DOM").find(c,".uiLinkButtonInput").value=a;return}if(!this.newTagBox)return;b("DOM").setContent(b("DOM").find(this.newTagBox,"div.tagName"),b("DOM").create("span",null,a));b("CSS").show(this.newTagBox);this.hideNewTagTimer=setTimeout(this.hideNewTag.bind(this),3e3)};i.prototype.hideNewTag=function(){"use strict";if(!this.newTagBox)return;this.hideNewTagTimer!==null&&(clearTimeout(this.hideNewTagTimer),this.hideNewTagTimer=null);b("CSS").hide(this.newTagBox)};i.prototype.getTaggerPositioningOrigin=function(){"use strict";return b("Vector").getElementPosition(this.clickState,"document")};i.prototype.setClickPosAndFacebox=function(a){"use strict";var c=this.viewer.getImage();this.saveClickPosition(c,a);c=b("PhotosUtils").absoluteToNormalizedPosition(c,a);this.setCurrentFacebox(this.findNearestFacebox(c))};i.prototype.addTagFromClickPos=function(a){"use strict";__p&&__p();this.currentTextbox=null;this.hideExistingTags();if(this.currentFacebox)this.addTagFromFaceboxDontSave(this.currentFacebox);else{var c=this.viewer.getImage(),d=b("PhotosUtils").absoluteToNormalizedPosition(c,a);if(this.tags!==undefined)for(var e=0;e<this.tags.length;e++)this.tags[e].rect.contains(d)&&(this.showExistingTag(this.tags[e]),this.currentTextbox=this.tags[e]);this.removeSuggestionFromTagger();b("CSS").removeClass(b("DOM").find(this.tagger,".faceBox"),"faceBoxHidden");if(this.currentTextbox){e=this.currentTextbox.rect.w()/100*b("Vector").getElementDimensions(c).x;this.addTagFromPosition(a,e)}else this.addTagFromPosition(a,this.TAG_BOX_SIZE)}};i.prototype.showExistingTag=function(a){"use strict";this.taggingMode?(this._hidePivots(),b("CSS").show(b("DOM").find(a.node,".tag")),b("CSS").addClass(a.node,"tagClick")):b("CSS").addClass(a.node,"hover"),this.hideTagger()};i.prototype.hideExistingTags=function(){"use strict";var a=b("DOM").scry(this.root,".tagClick");a&&a.forEach(function(a){b("CSS").removeClass(a,"tagClick"),this.taggingMode&&b("CSS").hide(b("DOM").find(a,".tag"))}.bind(this))};i.prototype.addTag=function(event){"use strict";var a=event.getTarget(),c=b("Parent").byClass(a,"fbPhotosPhotoButtons");if(!this.taggingMode||c&&a!==c||b("Parent").byClass(a,"fbPhotosPhotoActions")||b("Parent").byClass(a,"faceboxSuggestion")||b("Parent").byClass(a,"photoTagTypeahead")||b("Parent").byClass(a,"tagUfi"))return;c=b("Vector").getEventPosition(event);this.setClickPosAndFacebox(c);this.addTagFromClickPos(c)};i.prototype.addSpatialTag=function(a,event){"use strict";__p&&__p();var c=event.getTarget(),d=b("Parent").byClass(c,"fbPhotosPhotoButtons"),e=a.inTaggingMode?this.viewer.stageActions:this.viewer.stage;if(d&&c!==d||b("Parent").byClass(c,"fbPhotosPhotoActions")||b("Parent").byClass(c,"faceboxSuggestion")||b("Parent").byClass(c,"photoTagTypeahead")||b("Parent").byClass(c,"tagUfi")||!a.screenPos||!a.photoXY||!a.size||!this.isSpherical||!e)return;this.sphericalPhotoXY=a.photoXY;this.fromSphericalFacebox=a.fromTag;d=b("getElementPosition")(e);this.fromSphericalFacebox&&!!a.suggestion?this.addTagFromFaceboxDontSave(a.suggestion):this.removeSuggestionFromTagger();this.addTagFromPosition(b("Vector").from(a.screenPos.x+d.x,a.screenPos.y+d.y,"document"),a.size);c=b("DOM").find(this.tagger,".faceBox");this.fromSphericalFacebox&&!b("CSS").hasClass(c,"faceBoxHidden")&&b("CSS").addClass(c,"faceBoxHidden");!this.fromSphericalFacebox&&b("CSS").hasClass(c,"faceBoxHidden")&&b("CSS").removeClass(c,"faceBoxHidden")};i.prototype.showTagIfCommentAdded=function(){"use strict";__p&&__p();if(this.taggingMode){var a=this.getClickPointForSave(),c=b("Vector").from(a.x,a.y);if(a!==null)for(var a=0;a<this.tags.length;a++)if(this.tags[a].rect.contains(c)){this.showExistingTag(this.tags[a]);this.hideTagger();return}}};i.prototype.commentAdded=function(a,c){"use strict";__p&&__p();a.forEach(function(a){__p&&__p();var c=this.getClickPointForSave(),d=null;if(a.isPhotoTag&&(a.photoTextTagID===null||a.photoTextTagID===undefined)&&a.photoTagX!==null&&a.photoTagY!==null)if(c!==null&&a.photoTagX===c.x&&a.photoTagY===c.y)d=b("DOM").find(this.tagger,"._12nb");else{c=new(b("Vector"))(a.photoTagX,a.photoTagY);c=this.findNearestTag(c);c!==null&&(d=b("DOM").find(c.node,"._12nb"))}if(d!==null){c=b("DOM").find(d,".UFIContainer");var e={};e[a.author]={id:a.author};b("ReactDOM").render(b("React").createElement(b("UFIContainer.react"),null,b("React").createElement(b("UFIComment.react"),{comment:a,authorProfiles:e,feedback:{},contextArgs:{}})),c);b("Style").set(b("DOM").find(d,".UFIAddComment"),"opacity",.5);b("DOM").find(d,"textarea").setAttribute("disabled","disabled")}},this)};i.prototype.showTaggerUFI=function(event){"use strict";__p&&__p();var a=b("DOM").find(this.tagger,".typeaheadContainer"),c=b("DOM").find(this.tagger,"._12nb"),d=b("DOM").find(c,".arrow .nub"),e=3,f=b("getElementPosition")(c);f.x<=0&&!b("CSS").hasClass(this.tagger,"fbPhotoTaggerFlipped")?(b("Style").set(c,"margin-left",-2*f.x+"px"),b("Style").set(d,"margin-left",f.x-e+"px")):(b("Style").set(c,"margin-left",0),b("Style").set(d,"margin-left",0));f=this.getClickPointForSave();e=b("DOM").find(c,".tagUfiAddComment");d=b("DOM").find(this.viewer.ufiInputContainer,'input[name="ft_ent_identifier"]');d={ftentidentifier:d.value,source:e.getAttribute("data-source"),mentionsinput:{inputComponent:b("LegacyMentionsInput.react")},hideActorPhoto:!0,isPhotoTag:!0,photoFBID:this.viewer.getCurrentPhotoInfo().fbid,photoTagX:f.x,photoTagY:f.y};this.addCommentController=b("UFIAddCommentController").factory(e,d);f=b("DOM").find(c,".UFIContainer");f.firstChild!==null&&b("DOM").remove(f.firstChild);b("Style").set(b("DOM").find(c,".UFIAddComment"),"opacity",1);b("DOM").find(c,"textarea").removeAttribute("disabled");b("CSS").show(this.tagger);b("CSS").hide(a);b("CSS").show(c);b("Arbiter").inform("reflow")};i.prototype._findNearest=function(a,b){"use strict";var c=Infinity,d=null;a.forEach(function(a){if(a.rect.contains(b)){var e=b.distanceTo(a.rect.getCenter());e<c&&(c=e,d=a)}});return d};i.prototype.findNearestFacebox=function(a){"use strict";return this._findNearest(this.faceboxes,a)};i.prototype.findNearestTag=function(a){"use strict";return this._findNearest(this.tags,a)};i.prototype.addNextTagFromFacebox=function(a){"use strict";__p&&__p();if(this.faceboxes.length===0)return;if(!this.currentFacebox)this.setCurrentFacebox(this.faceboxes[0]);else{var b=this.faceboxes.indexOf(this.currentFacebox);a=h(b+a,this.faceboxes.length);if(a===b)return;this.setCurrentFacebox(this.faceboxes[a])}this.addTagFromFacebox(this.currentFacebox)};i.prototype.addTagFromFaceboxDontSave=function(a){"use strict";__p&&__p();b("CSS").addClass(a.node,"active");b("CSS").addClass(b("DOM").find(this.tagger,".faceBox"),"faceBoxHidden");var c=a.rect.getCenter(),d=this.viewer.getImage();c=b("PhotosUtils").normalizedToAbsolutePosition(d,c);d=a.rect.w()/100*b("Vector").getElementDimensions(d).x;a.rect.w()>this.HUGE_FACE_THRESH&&a.rect.h()>this.HUGE_FACE_THRESH&&(d*=this.HUGE_FACE_SHRINK_FACTOR);var e=this.getFaceboxSuggestionFromFaceboxElem(a.node);if(e){var f=this.version===b("PhotosConst").VIEWER_PERMALINK?b("FaceboxSourceConstants").PERMALINK_DISMISS:b("FaceboxSourceConstants").SNOWLIFT_DISMISS;this.addSuggestionToTagger(a,e);this._sendFaceboxSuggestionLogSignal(e.getAttribute("data-id"),f,a.id)}else this.removeSuggestionFromTagger();this.isSpherical||this.addTagFromPosition(c,d);return c};i.prototype.getFaceboxSuggestionFromFaceboxElem=function(a){"use strict";return b("DOM").scry(a,"._570u")[0]};i.prototype.addSuggestionToTagger=function(a,c){"use strict";this.removeSuggestionFromTagger();b("CSS").addClass(this.tagger,"suggestionActive");var d=b("DOM").find(this.tagger,".typeaheadContainer");c=c.cloneNode(!0);this.stripReactID(c);b("DOM").appendContent(d,c);this.setupFaceboxSuggestionHandlers(a,c)};i.prototype.stripReactID=function(a){"use strict";a.removeAttribute("data-reactid");for(var b=0;b<a.children.length;b++)this.stripReactID(a.children[b])};i.prototype.removeSuggestionFromTagger=function(){"use strict";b("CSS").removeClass(this.tagger,"suggestionActive");var a=b("DOM").scry(this.tagger,".faceboxSuggestion");a&&a.forEach(function(a){b("DOM").remove(a)})};i.prototype.dismissFaceboxSuggestion=function(a,c,d,e){"use strict";new(b("AsyncRequest"))().setURI("/ajax/dismiss_tag_suggest.php").setMethod("POST").setData({facebox_logs:[{facebox:a,log_data:{photo_owner:d,tagee:c,is_first:!0}}],closing_source:e,closing_action:"no"}).setAllowCrossPageTransition(!0).send()};i.prototype.addTagFromFacebox=function(a){"use strict";this.currentTextbox=null;a=this.addTagFromFaceboxDontSave(a);var b=this.viewer.getImage();this.saveClickPosition(b,a)};i.prototype.addTagFromPosition=function(a,c){"use strict";__p&&__p();var d=this.viewer.getImage(),e=this.calcTaggerPosition(d,a,c);this.calcClickPoint(d,a);if(!e){this.hideTagger();return}e.setElementPosition(this.tagger);this.newTagBox&&(e.setElementPosition(this.newTagBox),new(b("Vector"))(c,c).setElementDimensions(this.newTagBox));e=b("Vector").getElementPosition(d);c=b("Vector").getElementDimensions(d);d=this.typeahead.getView();a.y>e.y+c.y*3/4?(b("CSS").addClass(this.tagger,"fbPhotoTaggerFlipped"),d.addTypeaheadFlip("fbPhotoTaggerFlipped"),a.x>e.x+c.x*1/2?this.flipRules("fbPhotoTaggerRight","fbPhotoTaggerLeft",d):this.flipRules("fbPhotoTaggerLeft","fbPhotoTaggerRight",d)):(b("CSS").removeClass(this.tagger,"fbPhotoTaggerFlipped"),b("CSS").removeClass(this.tagger,"fbPhotoTaggerLeft"),b("CSS").removeClass(this.tagger,"fbPhotoTaggerRight"),d.removeTypeaheadFlip("fbPhotoTaggerFlipped"),d.removeTypeaheadFlip("fbPhotoTaggerLeft"),d.removeTypeaheadFlip("fbPhotoTaggerRight"));(!this.taggingMode||this.currentTextbox===null)&&this.ufi&&this.currentFacebox===null?this.showTaggerUFI():this.showTagger();this.taggingMode?this._sendWaterfallLogSignal(b("PhotosTaggingWaterfall").TAG_FACE):this._sendWaterfallLogSignal(b("PhotosTaggingWaterfall").HOVER_TAG_FACE)};i.prototype.flipRules=function(a,c,d){"use strict";b("CSS").addClass(this.tagger,a),b("CSS").removeClass(this.tagger,c),d.addTypeaheadFlip(a),d.removeTypeaheadFlip(c)};i.prototype.calcTaggerPosition=function(a,c,d,e){"use strict";__p&&__p();e=e||d;var f=b("Vector").getElementPosition(a);a=b("Vector").getElementDimensions(a);var g=new(b("Vector"))(d/2,e/2),h=c.sub(f);for(var i in{x:1,y:1}){if(c[i]<f[i]||c[i]>f[i]+a[i])return null;var j=i==="x"?d:e;h[i]<j/2?g[i]=h[i]:a[i]<h[i]+j/2&&(g[i]=j-(a[i]-h[i]))}j=3;a=b("DOM").find(this.tagger,".faceBox");f=Math.max(0,d-j*2);h=Math.max(0,e-j*2);b("Style").set(a,"width",f+"px");b("Style").set(a,"height",h+"px");d=c.sub(this.getTaggerPositioningOrigin());return d.sub(g.x,g.y)};i.prototype.calcClickPoint=function(a,c){"use strict";var d=b("Vector").getElementDimensions(a);a=b("Vector").getElementPosition(a);c=c.sub(a);!this.isSpherical?this.clickPoint={x:c.x/d.x,y:c.y/d.y}:this.clickPoint={x:this.sphericalPhotoXY.x,y:this.sphericalPhotoXY.y}};i.prototype.getClickPointForSave=function(){"use strict";return this.clickPoint===undefined?null:{x:this.clickPoint.x*100,y:this.clickPoint.y*100}};i.prototype.getTaggingDataForSave=function(a,b){"use strict";a=this.getTaggingData("add",a.isFreeform()?"":a.getValue(),a.getText(),b);b=this.getClickPointForSave();a.x=b.x;a.y=b.y;a.from_facebox=this.isSpherical?this.fromSphericalFacebox:!!this.currentFacebox;a.tagging_mode=!!this.taggingMode;return a};i.prototype.saveTag=function(a,c,d){"use strict";__p&&__p();if(this.disableSaveSpatialTag&&this.isSpherical&&this.tagAccumulating)return;a=this.getTaggingDataForSave(c,d);if(this.tagAccumulating)this.isSpherical?b("Arbiter").inform("PhotoTagger.SAVE_SPATIAL_TAG",a):b("PhotoTagStore").getInstance().storeTagWithOptions(this.photoData.fbid,a.subject,a.x,a.y,a);else{this.isSpherical&&b("Arbiter").inform("PhotoTagger.SAVE_SPATIAL_TAG");d=b("ActorURI").create(this.ajaxURIs.tagAction,this.photoData.owner);new(b("AsyncRequest"))().setURI(d).setMethod("POST").setData(a).setAllowCrossPageTransition(!0).setHandler(this.tagsChangeHandler.bind(this)).setErrorHandler(this.checkError.bind(this,c)).send()}d=this.userId===a.subject;if(d&&!this.isSpherical){var e=b("DOM").scry(this.makeProfilePicMenuContainer,'[data-picid="'+this.viewer.getCurrentPhotoInfo().fbid+'"]');if(e.length===1){e=e[0];b("CSS").removeClass(e,"hide")}}if(!this.isSpherical){e=new(b("Vector"))(a.x,a.y);var f=this.findNearestTag(e);f&&f.rect.contains(e)?this.showNewTag(c.getText(),f.node):this.showNewTag(c.getText())}this.hideTagger();if(!this.isSpherical){e=this.currentFacebox;e&&(this.taggingMode&&this.addNextTagFromFacebox(1),this.removeFacebox(e))}b("Arbiter").inform("PhotoTagger.ADDING_TAG",{subject:a.subject,text:c.getText()});b("Arbiter").inform("PhotoTagger.SAVE_TAG",{photo_fbid:this.photoData.fbid,self_tag:d})};i.prototype.getTaggingData=function(a,b,c,d){"use strict";return{cs_ver:this.version,pid:this.photoData.pid,fbid:this.photoData.fbid,id:this.photoData.owner,subject:b,name:c,action:a,source:d?d:this.viewer.getSourceString(),qn:this._qn,position:this.getPosition(),slsource:this.viewer.getViewerSource(),slset:this.viewer.getViewerSet()}};i.prototype.getPosition=function(){"use strict";return this.viewer.getPosition()};i.prototype.tagsChangeHandler=function(a){"use strict"};i.prototype.checkError=function(a,c){"use strict";c.getPayload()&&c.getPayload().clear_tag&&(a.already_untagged=!0,this.tokenizer.removeToken(a)),b("AsyncResponse").defaultErrorHandler(c)};i.prototype.removeTag=function(a,c,d){"use strict";__p&&__p();if(c.already_untagged||this.tagAccumulating&&this.isSpherical)return;a="remove";b("DOM").scry(c.element,"a.pending")[0]&&(a="retract");c.blockUser&&(a="remove_block");this.tagAccumulating?c.isFreeform()?b("PhotoTagStore").getInstance().removeTextTag(this.photoData.fbid,c.getInfo().text):b("PhotoTagStore").getInstance().removeTag(this.photoData.fbid,c.getInfo().uid):new(b("AsyncRequest"))().setURI(this.ajaxURIs.tagAction).setMethod("POST").setData(this.getTaggingData(a,c.isFreeform()?"":c.getInfo().uid,c.getInfo().text)).setHandler(function(a){this.tagsChangeHandler(a),d&&d()}.bind(this)).setAllowCrossPageTransition(!0).send();if(this.userId===parseInt(c.getValue(),10)&&this.userId!==this.viewer.getCurrentPhotoInfo().owner){a=b("DOM").scry(this.makeProfilePicMenuContainer,'[data-picid="'+this.viewer.getCurrentPhotoInfo().fbid+'"]');if(a.length===1){c=a[0];b("CSS").addClass(c,"hide")}b("Arbiter").inform("PhotoTagger.REMOVED_MAKE_PROFILE_PIC_OPTION")}};i.prototype.removeTagByID=function(a,b,c){"use strict";a=this.tokenizer.tokens;for(var d=0;d<a.length;d++)if(a[d].info.uid==b)return this.removeTag(null,a[d],c);return null};i.prototype.removeTagByIDFromHovercardLink=function(a,c,d){"use strict";this.removeTagByID(a,c,function(){b("Hovercard").contains(d)&&b("Hovercard").hide(!0)})};i.prototype.removeWithTag=function(a,c){"use strict";new(b("AsyncRequest"))().setURI(this.ajaxURIs.tagWithAction).setMethod("POST").setData({action:"remove_with",taggee:c,tag:a,version:this.version,fbid:this.photoData.fbid}).setHandler(function(a){this.tagsChangeHandler(a),b("Hovercard").hide(!0)}.bind(this)).setAllowCrossPageTransition(!0).send()};i.prototype.setPhotoData=function(a,b){"use strict";this.clickPercentToPhoto=null;this.photoData=b;this.isSpherical=b.isSpherical;return this};i.prototype.setExtraData=function(a,b){"use strict";this.tagRects=b.tagRects;b.spatialTags&&(this.spatialTags=b.spatialTags);this.updateFaceboxes();this.setupAddTagHandlers();this._setInitialFaceboxFromID(b);b.openTag&&setTimeout(function(){this.activateTagging(),this._setInitialFaceboxFromID(b),this.faceboxes.length===1?this.addTagFromFacebox(this.currentFacebox):this.addNextTagFromFacebox(1)}.bind(this),0);return this};i.prototype._setInitialFaceboxFromID=function(a){"use strict";if(a.initialFaceboxID!==null&&this.faceboxes.length!==0){a=this.getFacebox(a.initialFaceboxID);if(a!==null){a=this.faceboxes.indexOf(a);a=h(a-1,this.faceboxes.length);this.setCurrentFacebox(this.faceboxes[a])}}};i.prototype.markTagAsSpam=function(a,c){"use strict";new(b("AsyncRequest"))().setURI(this.ajaxURIs.tagAction).setMethod("POST").setData(this.getTaggingData("mark_as_spam",c,null)).send()};i.prototype.removeFacebox=function(a){"use strict";if(a===null)return;this.revokedFaceboxes.push(a.rect.getCenter());b("removeFromArray")(this.faceboxes,a);b("DOM").remove(a.node);a===this.currentFacebox&&this.setCurrentFacebox(null)};i.prototype.setCurrentFacebox=function(a){"use strict";this.currentFacebox&&b("CSS").removeClass(this.currentFacebox.node,"active"),this.currentFacebox=a,a&&(this.recognizedUsers=JSON.parse(a.node.getAttribute("data-recognizeduids")),this.updateTypeaheadSuggestions())};i.prototype.updateRevokedFaceboxes=function(){"use strict";__p&&__p();this.revokedFaceboxes=this.revokedFaceboxes.filter(function(a){for(var b=0;b<this.faceboxes.length;++b){var c=this.faceboxes[b];c=a.distanceTo(c.rect.getCenter());if(c<this.EPSILON)return!0}return!1}.bind(this)),this.revokedFaceboxes.forEach(function(a){a=this.findNearestFacebox(a);b("removeFromArray")(this.faceboxes,a);b("DOM").remove(a.node)}.bind(this))};i.prototype.updateFaceboxes=function(){"use strict";__p&&__p();this.faceboxes=[];this.tags=[];for(var a in this.tagRects){var c;b("PhotosUtils").isFacebox(a)?c=this.faceboxes:b("PhotosUtils").isTag(a)&&(c=this.tags);if(c){var d="container";this.version===b("PhotosConst").VIEWER_PERMALINK&&(d="root");d=b("DOM").scry(this.viewer[d],"#"+a);d.length>0&&c.push({node:d[0],id:a,rect:this.tagRects[a]})}this.showTagIfCommentAdded()}this.updateRevokedFaceboxes();this.faceboxes.sort(function(a,b){return a.rect.getCenter().x-b.rect.getCenter().x});if(this.currentFacebox){d=this.currentFacebox.rect.getCenter();this.setCurrentFacebox(this.findNearestFacebox(d));b("CSS").addClass(this.currentFacebox.node,"active")}this.requestFaceboxNextTag&&(this.addNextTagFromFacebox(1),this.requestFaceboxNextTag=!1)};i.prototype.getFacebox=function(a){"use strict";for(var b=0;b<this.faceboxes.length;++b)if(this.faceboxes[b].id===a)return this.faceboxes[b];return null};i.prototype.setupFaceboxSuggestionHandlers=function(a,c){"use strict";__p&&__p();var d=b("DOM").find(c,"a._570w"),e=b("DOM").find(c,"a._570x");this.handlers.push(b("Event").listen(d,"click",function(d){d=this._getCurrentFaceboxID();var e=this.version===b("PhotosConst").VIEWER_PERMALINK?b("FaceboxSourceConstants").PERMALINK_DISMISS:b("FaceboxSourceConstants").SNOWLIFT_DISMISS;this.dismissFaceboxSuggestion(a.id.replace("face:",""),c.getAttribute("data-id"),this.photoData.owner,e);this.removeSuggestionFromTagger();this.hideTagger();b("DOM").remove(this.getFaceboxSuggestionFromFaceboxElem(a.node));b("Arbiter").inform("PhotoTagger.TAG_SUGGESTION_REJECTED/"+d)}.bind(this)),b("Event").listen(e,"click",function(a){a=this._getCurrentFaceboxID();var d={uid:c.getAttribute("data-id"),text:c.getAttribute("data-text")};d=this.tokenizer.createToken(d);var e=this.version===b("PhotosConst").VIEWER_PERMALINK?b("FaceboxSourceConstants").PERMALINK_SUGGEST:b("FaceboxSourceConstants").SNOWLIFT_SUGGEST;this.saveTag(null,d,e);b("Arbiter").inform("PhotoTagger.TAG_SUGGESTION_CONFIRMED/"+a)}.bind(this)))};i.prototype._getCurrentFaceboxID=function(){"use strict";return this.currentFacebox&&this.currentFacebox.id.substring(5)};i.getInstance=function(a){"use strict";return i.instances[a]};i.resetAlbumTaggingSuggestions=function(a){"use strict";a=i.getInstance(a);a&&a.resetAlbumTaggingSuggestions()};Object.assign(i,{instances:{}});e.exports=i}),null);
__d("PhotoBulkEditTagger",["csx","Arbiter","AsyncRequest","CSS","DOM","DOMQuery","Event","FaceboxSourceConstants","Parent","PersistentAlbumDataStore","PhotosConst","PhotosTaggingWaterfall","PhotoTagger","PhotoTagStore","SubscriptionsHandler","Vector","$","ge"],(function(a,b,c,d,e,f,g){__p&&__p();var h,i=60;c=babelHelpers.inherits(a,b("PhotoTagger"));h=c&&c.prototype;function a(a,c,d,e){"use strict";h.constructor.call(this,a),this.editor=a,this.faceboxes=[],this._qn=e.qn,this.tokenizer=d,this.editor.registerTagger(this),this.typeahead=d.getTypeahead(),this.handlers=new(b("SubscriptionsHandler"))(),this.root=this.editor.getRoot(),this.tagger=c,this.hideNewTagTimer=null,this.photoKey=null,this._needTaggingData=!0,this._currentRecognition={box:null,isTagged:!1,suggestion:null},this._hoverState=!1,this._tagging=!1,this.setupHandlers(),this._sendWaterfallLogSignal(b("PhotosTaggingWaterfall").BEGIN),this.fetchTaggingSuggestions(),this.setTagAccumulator(e.bulkSaveTags),this.setNeedTaggingData(e.needTaggingData),this.version=b("PhotosConst").BULK_EDITOR,b("Event").listen(this.root,"mousemove",function(event){var a=event.getTarget();this._hoverState&&!(b("Parent").byClass(a,"faceBox")||b("Parent").byClass(a,"tagPointer")||b("Parent").byClass(a,"arrow")||b("Parent").byClass(a,"faceboxSuggestion"))&&(this.removeSuggestionFromTagger(),this.hideTagger())}.bind(this))}a.prototype.setupUserActionLogging=function(){"use strict";return null};a.prototype.logUserActionEvent=function(a){"use strict";return null};a.prototype.addFaceboxes=function(a){"use strict";__p&&__p();this.faceboxes=b("DOMQuery").scry(a.parentNode,".faceBox");this.faceboxes.sort(function(a,b){return a.offsetLeft===b.offsetLeft?a.offsetTop-b.offsetTop:a.offsetLeft-b.offsetLeft});var c=b("Parent").byClass(a,"editablePhoto"),d=b("PhotoTagStore").getInstance().getPhotoTags(c.getAttribute("data-photoid")),e=[];Object.keys(d).forEach(function(a){d[a].fbid&&(e[d[a].fbid]=!0)});this.faceboxes.forEach(function(c){var f=this.getFaceboxSuggestionFromFaceboxElem(c),g=c.getAttribute("data-faceboxid");if(f&&d[f.getAttribute("data-id")]||e[g]){b("DOM").remove(c);return}f={image:a,facebox:c};b("Event").listen(c,"mouseenter",this._mouseOverFacebox.bind(this,f))}.bind(this))};a.prototype.saveTag=function(a,c,d){"use strict";if(!c.info.recovered){h.saveTag.call(this,a,c,d);a=this.getTaggingDataForSave(c,d);b("PersistentAlbumDataStore").saveTag(this.photoData.albumFBID,this.photoData.fbid,a)}b("Arbiter").inform("PhotoBulkEditTagger.TAG_SAVED",{editor:this.root,fbid:this.photoData.fbid})};a.prototype.recoverPhoto=function(a){"use strict";this.setupPhotoDataForTarget(a.getRoot());a=b("PersistentAlbumDataStore").getTags(this.photoData.albumFBID,this.photoData.fbid);a.forEach(function(a){var c=this.tokenizer.createToken({uid:a.subject?a.subject:a.name,text:a.name,suggestion:a.from_facebox,freeform:a.subject==="",recovered:!0});this.tokenizer.addToken(c);b("PhotoTagStore").getInstance().storeTagWithOptions(this.photoData.fbid,a.subject,a.x,a.y,a)}.bind(this))};a.prototype.setNeedTaggingData=function(a){"use strict";this._needTaggingData=a;return this};a.prototype.setTagAccumulator=function(a){"use strict";h.setTagAccumulator.call(this,a);return this};a.prototype.needTaggingData=function(){"use strict";return this._needTaggingData};a.prototype.setupHandlers=function(){"use strict";b("Event").listen(this.root,"click",this.clickHandler.bind(this)),this.tokenizer.subscribe(["addToken","removeToken"],this.handleTokenAction.bind(this)),this.tokenizer.subscribe("switchTarget",this.switchPhoto.bind(this)),this.tokenizer.subscribe("initialized",this.editor._recoverPhotos.bind(this.editor)),b("Arbiter").subscribe("PhotoBulkEditTagger.DATA_SOURCE_READY",this.useTaggingDataSource.bind(this)),b("Arbiter").subscribe(this.editor.mapEventNameToNamespace("PhotosBulkEditor.PHOTO_REORDER_START"),this.hideTagger.bind(this))};a.prototype.hideTagger=function(){"use strict";h.hideTagger.apply(this,arguments),this._currentRecognition.box&&!this._currentRecognition.isTagged&&b("CSS").show(this._currentRecognition.box),this._tagging=!1,this._hoverState=!1,this._currentRecognition.box=null,this._currentRecognition.isTagged=!1,this._currentRecognition.suggestion=null,this.recognizedUsers=[]};a.prototype.done=function(){"use strict";this._sendWaterfallLogSignal(b("PhotosTaggingWaterfall").FINISH)};a.prototype.handleTokenAction=function(a,c){"use strict";__p&&__p();var d=b("$")(this.photoKey),e=b("DOM").find(d,".peopleIcon");d=b("DOM").find(d,".editablePhotoTagList");var f=b("DOM").find(e,".count"),g=this.tokenizer.getTokens().length,h=c.info.suggestion?b("FaceboxSourceConstants").UPLOADER_SUGGEST:null;this._currentRecognition.box&&(this._currentRecognition.isTagged=!!g);b("CSS").conditionClass(e,"hasPeople",!!g);b("CSS").conditionClass(d,"hasPeople",!!g);b("DOM").setContent(f,g);if(a=="addToken"){this.saveTag(a,c,h);return}else this.removeTag(a,c),b("PersistentAlbumDataStore").removeTag(this.photoData.albumFBID,this.photoData.fbid,c.info.uid),b("Arbiter").inform("PhotoBulkEditTagger.TAG_REMOVED",{editor:this.root,fbid:this.photoData.fbid})};a.prototype.useTaggingDataSource=function(a,b){"use strict";if(!this._needTaggingData)return;a=this.tokenizer.getTypeahead();a.swapData(b);this.setNeedTaggingData(!1)};a.prototype.getTaggerPositioningOrigin=function(){"use strict";return b("Vector").getElementPosition(this.root)};a.prototype.getRecognitionBoxCenter=function(a,c){"use strict";a=b("Vector").getElementPosition(a).add(b("Vector").getElementDimensions(a).mul(.5));var d=b("Vector").getElementDimensions(this._currentRecognition.box);c=this.calcTaggerPosition(c,a,d.x,d.y);return{boxPos:a,boxDim:d,taggerPos:c}};a.prototype.setUpTagger=function(a,c,d,e,f){"use strict";this.calcClickPoint(a,d),f.setElementPosition(this.tagger),e&&e.setElementDimensions(this.tagger),b("CSS").hide(b("DOM").find(c,".clickToTagMessage")),this._sendWaterfallLogSignal(b("PhotosTaggingWaterfall").TAG_FACE),this.updateTypeaheadSuggestions(),this.updateWithSuggestions(),this.showTagger(),this._tagging=!0};a.prototype.clickHandler=function(event){"use strict";__p&&__p();var a=event.getTarget();if(b("Parent").byClass(a,"photoTagTypeahead"))return;if(this._hoverState){this._hoverState=!1;this._tagging=!0;return}this.tagger&&(this.hideTagger(),this.removeSuggestionFromTagger(),this.handlers.release());if(b("Parent").byClass(a,"photoContextualSelector")||b("Parent").byClass(a,"removePhotoButton"))return;var c=b("Parent").byClass(a,"editablePhotoImage");if(!c){var d=b("Parent").byClass(a,"peopleIcon");d&&this.setupPhotoDataForTarget(d);return}if(b("DOMQuery").scry(c,".clickToTagMessage").length===0)return;this.setupPhotoDataForTarget(c);d=b("DOM").find(c,".scaledImage img");var e=null,f=null,g=null,h=b("Parent").byClass(a,"faceBox");h||(h=b("Parent").byClass(a,"recognitionBox"));this._currentRecognition.box=h;if(this._currentRecognition.box&&b("CSS").shown(this._currentRecognition.box)){a=this.getRecognitionBoxCenter(h,d);e=a.boxPos;f=a.boxDim;g=a.taggerPos;b("CSS").hide(this._currentRecognition.box);this._currentRecognition.isTagged=!1;a=this.getFaceboxSuggestionFromFaceboxElem(h);a?(this._currentRecognition.suggestion=a,this.addSuggestionToTagger(h,a),this._sendFaceboxSuggestionLogSignal(a.getAttribute("data-id"),b("FaceboxSourceConstants").UPLOADER_SUGGEST)):this.recognizedUsers=JSON.parse(h.getAttribute("data-recognizeduids"))}g===null&&(e=b("Vector").getEventPosition(event),g=this.calcTaggerPosition(d,e,i));if(!g)return;this.setUpTagger(d,c,e,f,g)};a.prototype._mouseOverFacebox=function(a){"use strict";__p&&__p();if(this._tagging)return;var c=a.image;a=a.facebox;var d=this.getFaceboxSuggestionFromFaceboxElem(a);if(d){this._hoverState=!0;this._currentRecognition.box=a;this._currentRecognition.suggestion=d;this.setupPhotoDataForTarget(c);this.addSuggestionToTagger(a,d);this._sendFaceboxSuggestionLogSignal(d.getAttribute("data-id"),b("FaceboxSourceConstants").UPLOADER_SUGGEST);this._sendWaterfallLogSignal(b("PhotosTaggingWaterfall").HOVER_TAG_FACE);d=b("Vector").getElementPosition(a).add(b("Vector").getElementDimensions(a).mul(.5));a=b("Vector").getElementDimensions(this._currentRecognition.box);var e=this.calcTaggerPosition(c,d,a.x,a.y);this.calcClickPoint(c,d);e.setElementPosition(this.tagger);a.setElementDimensions(this.tagger);this.showTagger()}};a.prototype.fetchTaggingSuggestions=function(){"use strict";this.logUserActionEvent("sugg_fetch"),new(b("AsyncRequest"))().setURI(this.ajaxURIs.tagsInit).setData({owner:this.photoData.owner}).setOption("retries",1).setHandler(function(a){a=a.getPayload();this.featuredSuggestions=a.featuredTaggees;this.friendSuggestions=a.friendTaggees;this.logUserActionEvent("sugg_fetch_done")}.bind(this)).send()};a.prototype.switchPhoto=function(a,c){"use strict";a=b("ge")(c);a&&this.setupPhotoDataForTarget(a);this.hideTagger()};a.prototype.getImageByID=function(a){"use strict";return b("ge")("editablePhoto_"+a)};a.prototype.setupPhotoDataForTarget=function(a){"use strict";__p&&__p();var c;a&&!b("CSS").hasClass(a,"editablePhoto")?c=b("Parent").byClass(a,"editablePhoto"):c=a;if(!c){this.photoKey=null;this.photoData=null;return!1}a=c.id;if(a===this.photoKey)return;this.photoKey=a;this.photoData=this.editor.getPhotoData(a);this.tokenizer.setTokenarea(b("DOM").find(c,"div.editablePhotoTagList"))};a.prototype.getPosition=function(){"use strict";return this.photoData.fbid};a.prototype.tagsChangeHandler=function(a){"use strict"};a.prototype.removeTagByID=function(a,b,c){"use strict";this.hideTagger(),this.setupPhotoDataForTarget(this.getImageByID(a)),h.removeTagByID.call(this,a,b,c)};a.prototype.setupFaceboxSuggestionHandlers=function(a,c){"use strict";var d=b("DOM").find(c,"._570w"),e=b("DOM").find(c,"._570x");this.handlers.engage();this.handlers.addSubscriptions(b("Event").listen(d,"click",function(d){this.dismissFaceboxSuggestion(a.id.replace("face:",""),c.getAttribute("data-id"),this.photoData.owner,b("FaceboxSourceConstants").UPLOADER_DISMISS),this.removeSuggestionFromTagger(),this.hideTagger(),b("DOM").remove(this.getFaceboxSuggestionFromFaceboxElem(a))}.bind(this)),b("Event").listen(e,"click",function(d){d=this.tokenizer.createToken({uid:c.getAttribute("data-id"),text:c.getAttribute("data-text"),suggestion:!0});this.removeSuggestionFromTagger();b("CSS").hide(a);this.tokenizer.addToken(d)}.bind(this)))};Object.assign(a.prototype,{elemNames:{}});e.exports=a}),null);
__d("PhotoBulkEditTokenizer",["DOM","Event","Input","Parent","Tokenizer","UserAgent_DEPRECATED","getObjectValues"],(function(a,b,c,d,e,f){__p&&__p();var g,h;g=babelHelpers.inherits(a,b("Tokenizer"));h=g&&g.prototype;a.prototype.init=function(a,b,c,d){"use strict";this._tokenareaListeners={},h.init.call(this,a,b,c,d),this.inform("initialized")};a.prototype.initEvents=function(){"use strict";var a=b("UserAgent_DEPRECATED").firefox()<4?"keypress":"keydown";b("Event").listen(this.input,"paste",this.paste.bind(this));b("Event").listen(this.input,a,this.keydown.bind(this))};a.prototype.setTokenarea=function(a){"use strict";this.tokenarea=a,this.addTokenareaListener(a),this.reset()};a.prototype.addTokenareaListener=function(a){"use strict";if(this._tokenareaListeners[a.id])return;var c=this.handleEvents.bind(this);this._tokenareaListeners[a.id]=b("getObjectValues")(b("Event").listen(a,{click:c,keydown:c}))};a.prototype.handleEvents=function(event){"use strict";var a=b("Parent").byClass(event.getTarget(),"editablePhotoTagList");if(!a)return;else this.tokenarea!==a&&(this.setTokenarea(a),this.inform("switchTarget",this.tokenarea.id));return h.handleEvents.call(this,event)};a.prototype.reset=function(){"use strict";var a=this.getTokenElements().map(function(a){return{uid:b("DOM").scry(a,"input")[0].value,text:b("DOM").scry(a,"input")[1].value}});b("Input").reset(this.input);return h.reset.call(this,a)};a.prototype.updateTokenareaVisibility=function(){"use strict";return null};a.prototype.insertToken=function(a){"use strict";b("DOM").prependContent(this.tokenarea,a.getElement())};function a(){"use strict";g.apply(this,arguments)}e.exports=a}),null);
__d("PhotosBulkBackdateEditor",["Arbiter","DOMQuery","Event","Focus","Form"],(function(a,b,c,d,e,f){__p&&__p();a={setup:function(a,c){__p&&__p();b("Event").listen(a,"click",function(){c.setContext(a),c.show()});var d=b("DOMQuery").find(c.getContent(),"^.photosBulkDatePicker .saveBackdatedTime");b("Event").listen(d,"click",function(){var d=b("Form").serialize(c.getContent()),e=d.backdated_date;d=parseInt(d.use_date_from_file,10)>0;var f=b("DOMQuery").scry(c.getContent(),"#hide_from_newsfeed")[0];f=f&&f.checked;b("Arbiter").inform("PhotosBulkBackdateEditor.SAVED",{context:a,backdatedDate:e,hideFromNewsfeed:f,useDateFromFile:d});c.hide();b("Focus").set(a)})}};e.exports=a}),null);
__d("ProgressiveDatepicker",["Arbiter","ArbiterMixin","CSS","DataStore","DOM","Event","Focus","Parent","getElementText","mixin","shield"],(function(a,b,c,d,e,f){__p&&__p();var g;function h(a){return new Date(a[0],a[1],a[2],a[3],a[4])}function i(a,c){while(a.length)b("DOM").insertAfter(c,a.pop())}a=babelHelpers.inherits(j,b("mixin")(b("ArbiterMixin")));g=a&&a.prototype;function j(a,c){"use strict";__p&&__p();g.constructor.call(this);this._root=a;this._savedLabels={};this._savedPeriodsBack=[];this._savedPeriodsFront=[];this._menus={};this._dayOrderAscending=c.dayorderascending;var d=0;c.gmtoffset!==undefined&&(d=-new Date().getTimezoneOffset()-c.gmtoffset);this._mintime=c.mintime&&new Date(1e3*c.mintime-d*6e4);this._maxtime=c.maxtime&&new Date(1e3*c.maxtime-d*6e4);b("DataStore").set(a,"datepicker",this);b("DOM").scry(a,"select").forEach(function(a){b("Event").listen(a,"change",b("shield")(this._handleChange,this,a));var c=b("Parent").byClass(a,"period");b("Event").listen(a,"focus",b("CSS").addClass.bind(null,c,"periodFocus"));b("Event").listen(a,"blur",b("CSS").removeClass.bind(null,c,"periodFocus"));this._setMenuSelectionState(a);a.getAttribute("data-name")==="month"&&this._filterInvalidDates()}.bind(this));b("DOM").scry(a,"a.periodLabel").forEach(function(a){var c=b("Parent").byClass(a,"period");b("Event").listen(a,"click",function(){b("CSS").addClass(c,"periodSelected"),b("CSS").addClass(c,"periodFocus"),b("Focus").set(b("DOM").find(c,"select"))})});this._filterInvalidDates();this.inform("initialized",this,b("Arbiter").BEHAVIOR_STATE)}j.prototype.setDate=function(a,b,c,d,e){"use strict";this._addSavedPeriods();var f=j.PERIODS;for(var g=0;g<f.length;g++)this._setValueForPeriod(f[g],arguments[g]);this._filterInvalidDates();this.inform("changed")};j.prototype.setDateWithTimestamp=function(a){"use strict";a=new Date(a);this.setDate(a.getFullYear(),a.getMonth()+1,a.getDate(),a.getHours(),a.getMinutes())};j.prototype.isSet=function(){"use strict";var a=j.PERIODS;for(var b=0;b<a.length;b++)if(this._getValueForPeriod(a[b]))return!0;return!1};j.prototype.getRoot=function(){"use strict";return this._root};j.prototype.getValues=function(){"use strict";var a=j.PERIODS,b={};for(var c=0;c<a.length;c++){var d=this._getValueForPeriod(a[c]);d&&(b[a[c]]=d)}return b};j.prototype.getDate=function(){"use strict";var a=this.getValues();return new Date(a.year||0,(a.month||1)-1,a.day||1,a.hour||0,a.minute||0)};j.prototype.getTimestamp=function(){"use strict";return Math.round(this.getDate().getTime()/1e3)};j.prototype._setValueForPeriod=function(a,b){"use strict";__p&&__p();a=this._menuForPeriodName(a);if(!a)return;b===undefined&&(b="");var c=a.options;for(var d=0,e=c.length;d<e;d++)if(c[d].value==b){a.selectedIndex=d;break}this._setMenuSelectionState(a)};j.prototype._getValueForPeriod=function(a){"use strict";a=this._menuForPeriodName(a);return a&&a.options[a.selectedIndex].value};j.prototype._handleChange=function(a){"use strict";this._setMenuSelectionState(a),this._filterInvalidDates(),this.inform("changed")};j.prototype._setMenuSelectionState=function(a){"use strict";__p&&__p();var c=b("Parent").byClass(a,"period");if(!c)return;b("CSS").hasClass(c,"periodRequired")?a.selectedIndex===0&&(a.selectedIndex=1):this._updateLabel(a);var d=a.getAttribute("data-name");a=a.options[a.selectedIndex].value;b("CSS").conditionClass(c,"periodSelected",a);b("CSS").conditionClass(this._root,this._selectedClass(d),a);a||this._resetMenu(j.PERIODS.indexOf(d)+1)};j.prototype._updateLabel=function(a){"use strict";var c=a.getAttribute("data-name"),d=a.options[0];this._savedLabels[c]||(this._savedLabels[c]=b("getElementText")(d));a.selectedIndex===0?b("DOM").setContent(d,this._savedLabels[c]):b("DOM").setContent(d,"--")};j.prototype._daysInMonth=function(a,b){"use strict";return new Date(a||1999,b+1||1,0).getDate()};j.prototype._daysInCurrentMonth=function(){"use strict";return this._daysInMonth(this._getValueForPeriod("year"),this._getValueForPeriod("month")-1)};j.prototype._menuForPeriodName=function(a){"use strict";this._menus[a]||(this._menus[a]=b("DOM").scry(this._root,"."+a+"Menu")[0]);return this._menus[a]};j.prototype._selectedClass=function(a){"use strict";return"uiProgressiveDatepickerSelected-"+a};j.prototype._resetMenu=function(a){"use strict";var c=j.PERIODS;for(;a<c.length;a++){var d=c[a],e=this._menuForPeriodName(d);if(!e)return;b("Parent").byClass(e,"periodRequired")?e.selectedIndex=1:(b("CSS").removeClass(b("Parent").byClass(e,"period"),"periodSelected"),b("CSS").removeClass(this._root,this._selectedClass(d)),e.selectedIndex=0,this._updateLabel(e))}};j.prototype._addSavedPeriods=function(){"use strict";__p&&__p();var a=j.PERIODS;for(var b=0;b<a.length;b++){var c=this._menuForPeriodName(a[b]);if(!c)return;this._savedPeriodsFront[b]||(this._savedPeriodsFront[b]=[]);this._savedPeriodsBack[b]||(this._savedPeriodsBack[b]=[]);var d=c.options[0];c=c.options[c.options.length-1];b===j.PERIODS.indexOf("hour")||b===j.PERIODS.indexOf("minute")||b===j.PERIODS.indexOf("day")&&this._dayOrderAscending?(i(this._savedPeriodsFront[b],d),i(this._savedPeriodsBack[b],c)):(i(this._savedPeriodsBack[b],d),i(this._savedPeriodsFront[b],c))}};j.prototype._filterInvalidDates=function(){"use strict";__p&&__p();this._addSavedPeriods();var a=j.PERIODS,c=this.getValues();for(var d=0;d<a.length;d++){var e=this._menuForPeriodName(a[d]);if(!e)return;this._savedPeriodsFront[d]||(this._savedPeriodsFront[d]=[]);this._savedPeriodsBack[d]||(this._savedPeriodsBack[d]=[]);for(var f=1;f<e.options.length;){var g=e.options[f],i=[d-1>=0?c[a[0]]:0,d-1>=1?c[a[1]]-1:0,d-1>=2?c[a[2]]:1,d-1>=3?c[a[3]]:0,d-1>=4?c[a[4]]:0];i[d]=g.value;d===j.PERIODS.indexOf("month")&&(i[d]=i[d]-1);i=h(i);var k=[d-1>=0?c[a[0]]:9001,d-1>=1?c[a[1]]-1:11,d-1>=2?c[a[2]]:this._daysInCurrentMonth(),d-1>=3?c[a[3]]:23,d-1>=4?c[a[4]]:59];k[d]=g.value;d===j.PERIODS.indexOf("month")&&(k[d]--,k[d+1]=this._daysInMonth(k[0],k[1]));k=h(k);i=i>this._maxtime;k=k<this._mintime;var l=d===j.PERIODS.indexOf("day")&&g.value>this._daysInCurrentMonth();k||i||l?(g.selected&&(g.selected=!1,this._resetMenu(d)),b("DOM").remove(g),i||l?this._savedPeriodsBack[d].push(g):this._savedPeriodsFront[d].push(g)):f++}}};j.getInstance=function(a){"use strict";return a?b("DataStore").get(a,"datepicker"):null};Object.assign(j,{PERIODS:["year","month","day","hour","minute"]});e.exports=j}),null);
__d("PhotosBulkEditablePhoto",["csx","cx","fbt","Arbiter","AsyncDialog","AsyncRequest","AsyncResponse","CSS","Dialog","DOM","Event","Focus","Form","Input","Parent","PhotosConst","PlaceUtils","ProgressiveDatepicker"],(function(a,b,c,d,e,f,g,h,i){__p&&__p();var j=null,k=null,l=!1;function a(a,c,d,e,f,g,h){"use strict";__p&&__p();this._root=a;this._mentionsTypeahead=c;this._placesTypeahead=d;this._photoData=e;this._hasOwnPlaceValue=!!d.getCore().getHiddenValue();c=b("DOM").find(a,".placesInput");e=b("DOM").find(a,".captionTextarea");var i=b("DOM").find(d.element,".uiTypeaheadCloseButton");this._metadataInputs=b("DOM").find(a,".metadataInputs");this._editorId=f;this._published=g;this._showMove=h;this._photoDataKey=this._root.id;this._hasTimeTaken=!!this._photoData.timeTaken;this._hasExistingDateValue=this._photoData.isBackdated;this._listeners=[b("Event").listen(a,"click",this._handleClick.bind(this)),b("Event").listen(c,"focus",this._placesFocus.bind(this)),b("Event").listen(e,"focus",this._captionFocus.bind(this)),b("Event").listen(e,"blur",this._save.bind(this)),b("Event").listen(i,"click",function(){setTimeout(this._save.bind(this),0)}.bind(this)),b("Event").listen(a,"submit",function(){return!1})];this._previousSaveData=b("Form").serialize(this._root);f=b("DOM").scry(this._root,"div.backdateInput .periodMenu");for(var g=0;g<f.length;g++){h=f[g];this._listeners.push(b("Event").listen(h,"change",function(){return this._saveDate()}.bind(this)))}c=b("DOM").scry(this._root,"._2sfm").pop();if(c){e=c.getAttribute("data-direction");this._listeners.push(b("Event").listen(c,"click",this._rotate.bind(this,e)))}i=b("DOM").scry(a,".photoContextualSelector")[0];if(i){h=b("DOM").scry(i,".moveAlbum")[0];h&&this._listeners.push(b("Event").listen(h,"click",this._move.bind(this)));f=b("DOM").scry(i,".albumCover")[0];f&&this._listeners.push(b("Event").listen(f,"click",this._setAlbumCover.bind(this)));g=b("DOM").scry(i,".removePhoto")[0];g&&this._listeners.push(b("Event").listen(g,"click",this.remove.bind(this)))}else{c=b("DOM").find(a,".removePhotoButton");this._listeners.push(b("Event").listen(c,"click",this.remove.bind(this)))}this._placesDataListener=[d.subscribe(["select","reset","render"],function(c,e){b("CSS").conditionClass(this._root,"focusedInput",c=="render");if(c=="render")return;if(c=="reset"&&d.getCore().getHiddenValue())return;e&&e.selected?(j=e.selected,k==j.text?l=!0:(k=j.text,l=!1)):(j=null,k=null,l=!1);this._hasOwnPlaceValue=c=="select";b("CSS").conditionClass(b("DOM").find(a,".placeIcon"),"hasPlace",this._hasOwnPlaceValue);this._hasOwnPlaceValue&&this._save()}.bind(this))];this._placesInputBlurListener=d.getCore().subscribe("blur",function(a,c){b("CSS").removeClass(this._root,"focusedInput")}.bind(this));b("Arbiter").inform(this.mapEventNameToNamespace("PhotosBulkEditablePhoto.INITIALIZED"),this,b("Arbiter").BEHAVIOR_PERSISTENT)}a.prototype.getPhotoDataKey=function(){"use strict";return this._photoDataKey};a.prototype.getPhotoData=function(){"use strict";return this._photoData};a.prototype.getRoot=function(){"use strict";return this._root};a.prototype.getDragHandle=function(){"use strict";return this.getRoot()};a.prototype.getRotateButtonType=function(){"use strict";return this._rotateButtonType};a.prototype.swapData=function(a,b){"use strict";var c=this._mentionsTypeahead.getData(),d=this._placesTypeahead.getData();c!==a&&this._mentionsTypeahead.swapData(a);if(d!==b){c=this._placesTypeahead.getCore().getValue();a=this._placesTypeahead.getCore().getHiddenValue();this._placesTypeahead.swapData(b);this.hasOwnPlaceValue()&&this._placesTypeahead.getCore().select({text:c,uid:a})}};a.prototype.hasOwnPlaceValue=function(){"use strict";return this._hasOwnPlaceValue};a.prototype.setAlbumPlace=function(a,c){"use strict";this._hasOwnPlaceValue=!1;var d=this._placesTypeahead.getCore();b("CSS").conditionClass(b("DOM").find(this._root,".placeIcon"),"hasPlace",!!a);a?d.select(a):d.reset();c||this._save()};a.prototype.addPlaceSelectHandler=function(a){"use strict";this._placesDataListener.push(this._placesTypeahead.subscribe("select",a))};a.prototype.mapEventNameToNamespace=function(a){"use strict";return a+(this._editorId?"/"+this._editorId:"")};a.prototype.setDate=function(a,c){"use strict";__p&&__p();if(this._hasExistingDateValue)return;var d=!a;a=a;if(d){if(!this._hasTimeTaken)return;a=Math.round(this._photoData.timeTaken/600)*600*1e3}var e=b("DOM").find(this.getRoot(),".uiProgressiveDatepicker");e=b("ProgressiveDatepicker").getInstance(e);e.setDateWithTimestamp(a);b("CSS").conditionClass(b("DOM").find(this._root,".dateIcon"),"hasDate",!!a);d&&this._saveDate(c)};a.prototype._doRemove=function(){"use strict";b("DOM").remove(this._root),this._unsubscribeAll(),b("Arbiter").inform(this.mapEventNameToNamespace("PhotosBulkEditablePhoto.REMOVED"),this)};a.prototype._unsubscribeAll=function(){"use strict";this._listeners.forEach(function(a){a.remove()}),this._listeners=[],this._placesDataListener.forEach(function(a){this._placesTypeahead.unsubscribe(a)}.bind(this)),this._placesTypeahead.getCore().unsubscribe(this._placesInputBlurListener)};a.prototype._handleClick=function(a){"use strict";__p&&__p();a=a.getTarget();if(b("Parent").byClass(a,"confirmPhotoBackdate")){this._saveDate();return}if(!b("Parent").byClass(a,"metaIcon"))return;b("CSS").addClass(this._root,"showControls");b("Parent").byClass(a,"placeIcon")?(this._showMetadataInput("place"),b("Focus").set(this._placesTypeahead.getCore().getElement())):b("Parent").byClass(a,"dateIcon")?this._showMetadataInput("date"):b("Parent").byClass(a,"peopleIcon")?(b("Arbiter").inform(this.mapEventNameToNamespace("PhotosBulkEditablePhoto.TAG_BUTTON_CLICKED"),this),this._showMetadataInput("people")):b("CSS").removeClass(this._root,"showControls")};a.prototype.hideMetadataInputs=function(){"use strict";this._showMetadataInput()};a.prototype._showMetadataInput=function(a){"use strict";["people","date","place"].forEach(function(c){b("CSS").conditionClass(this._metadataInputs,c,a==c)}.bind(this))};a.prototype._captionFocus=function(a){"use strict";this.hideMetadataInputs(),b("CSS").addClass(this._root,"focusedInput")};a.prototype.remove=function(){"use strict";var a={fbid:this._photoData.fbid,version:b("PhotosConst").BULK_EDITOR,confirmed:!0};new(b("Dialog"))().setTitle(i._("Delete Photo")).setBody(i._("Are you sure you want to delete this photo?")).setButtons(b("Dialog").OK_AND_CANCEL).setModal(!0).setHandler(function(){b("CSS").addClass(this._root,"editablePhotoWillBeRemoved"),new(b("AsyncRequest"))().setURI("/ajax/photos/photo/delete/dialog.php").setData(a).setHandler(function(a){a.getPayload().success?this._doRemove():b("CSS").removeClass(this._root,"editablePhotoWillBeRemoved")}.bind(this)).setErrorHandler(function(a){b("CSS").removeClass(this._root,"editablePhotoWillBeRemoved"),b("AsyncResponse").defaultErrorHandler(a)}.bind(this)).send()}.bind(this)).show()};a.prototype._setAlbumCover=function(){"use strict";var a={aid:this._photoData.aid,albumFBID:this._photoData.albumFBID,fbid:this._photoData.fbid,owner:this._photoData.owner,pid:this._photoData.pid};a=new(b("AsyncRequest"))().setURI("/ajax/photos/album/setcover/").setData(a).setAllowCrossPageTransition(!1);b("AsyncDialog").send(a)};a.prototype._move=function(){"use strict";var a={aid:this._photoData.aid,albumFBID:this._photoData.albumFBID,datakey:this._photoDataKey,fbid:this._photoData.fbid,owner:this._photoData.owner,pid:this._photoData.pid};a=new(b("AsyncRequest"))().setURI("/ajax/photos/photo/move/dialog.php").setData(a).setAllowCrossPageTransition(!1);b("AsyncDialog").send(a)};a.prototype._timeclose=function(a,b){"use strict";a=a||0;b=b||0;return Math.abs(a-b)<43200};a.prototype._placesFocus=function(a){"use strict";b("CSS").addClass(this._root,"focusedInput");a=b("DOM").scry(this._root,"input.latitude")[0];var c=b("DOM").scry(this._root,"input.longitude")[0],d=b("DOM").scry(this._root,"input.takentime")[0];d=d?b("Input").getValue(d):null;var e=this._placesTypeahead.getData(),f=e.getBootstrapData(),g={};a&&c?(g={latitude:b("Input").getValue(a),longitude:b("Input").getValue(c),proximity_boost:"true",city_id:null,search_time:d},e.setQueryData(g,!1),(!b("PlaceUtils").placesClose(f.latitude,f.longitude,g.latitude,g.longitude)||!this._timeclose(f.search_time,g.search_time))&&e.setBootstrapData(g,!1).setBootstrapEndpoint(e.getQueryEndpoint())):(g={latitude:null,longitude:null,proximity_boost:null,city_id:null,search_time:d},j&&(j.city_id?g.city_id=j.city_id:j.latitude&&j.longitude&&(g.latitude=j.latitude,g.longitude=j.longitude)),e.setQueryData(g,!1),!l?e.setBootstrapData(g).resetBootstrapEndpoint(!0):(!b("PlaceUtils").placesClose(f.latitude,f.longitude,g.latitude,g.longitude)||!this._timeclose(f.search_time,g.search_time))&&e.setBootstrapData(g,!1).resetBootstrapEndpoint())};a.prototype._saveDate=function(a){"use strict";var c=b("DOM").find(this._root,"div.backdateInput"),d=b("Form").serialize(c);d.source=this.source;d.fbid=this._photoData.fbid;d.version=b("PhotosConst").BULK_EDITOR;d.bulk=!!a;b("CSS").addClass(c,"backdating");new(b("AsyncRequest"))().setURI("/ajax/photos/photo/backdate/").setData(d).setRelativeTo(this._root).send()};a.prototype._save=function(){"use strict";__p&&__p();b("CSS").removeClass(this._root,"focusedInput");var a=b("Form").serialize(this._root);if(this._previousSaveData){var c=!1;for(var d in a){if(d!=="caption"&&d!=="location"&&d!=="location_data")continue;a[d]!==this._previousSaveData[d]&&(c=!0,this._previousSaveData[d]=a[d])}if(!c)return}a.source=this.source;a.bulk=!this._hasOwnPlaceValue;new(b("AsyncRequest"))().setURI("/ajax/photos/metadata/save/").setData(a).setAllowCrossPageTransition(!0).send()};a.prototype._setLoadingIndicator=function(a){"use strict";b("CSS").conditionClass(this._root,"_2sfl",a)};a.prototype._rotate=function(a){"use strict";var c={fbid:this._photoData.fbid,cs_ver:b("PhotosConst").BULK_EDITOR,editor_id:this._editorId,published:this._published,showMove:this._showMove};c[a]=1;this._setLoadingIndicator(!0);new(b("AsyncRequest"))("/ajax/photos/photo/rotate/").setData(c).setHandler(function(a){b("DOM").replace(this._root,a.getPayload()),this._unsubscribeAll(),b("Arbiter").inform(this.mapEventNameToNamespace("PhotosBulkEditablePhoto.ROTATED"),this)}.bind(this)).setFinallyHandler(function(){this._setLoadingIndicator(!1)}.bind(this)).setMethod("POST").send();return!1};e.exports=a}),null);
__d("PhotosBulkEditablePhotoPlaceholder",["csx","CSS","DOM","Event","mixInEventEmitter"],(function(a,b,c,d,e,f,g){__p&&__p();function a(a,b,c){"use strict";this._root=a,this._progressBar=b,this._uploadID=c,this._initAndGetGatedButton("._3273","cancelButtonClicked"),this._retryButton=this._initAndGetGatedButton("._3p03","retryButtonClicked"),this._errorOkayButton=this._initAndGetGatedButton("._8qx","dismissPlaceholder"),this._errorCloseButton=this._initAndGetGatedButton("._8qy","dismissPlaceholder")}a.prototype._initAndGetGatedButton=function(a,c){"use strict";a=b("DOM").scry(this._root,a);if(a.length){a=a[0];b("Event").listen(a,"click",function(){return this.emit(c,this._uploadID)}.bind(this));return a}};a.prototype.getProgressBar=function(){"use strict";return this._progressBar};a.prototype.getRoot=function(){"use strict";return this._root};a.prototype.hide=function(){"use strict";b("CSS").hide(this._root)};a.prototype.show=function(){"use strict";b("CSS").show(this._root)};a.prototype.showRetryButton=function(){"use strict";this._retryButton&&b("CSS").show(this._retryButton)};a.prototype.showErrorOkayButton=function(){"use strict";this._errorOkayButton&&b("CSS").show(this._errorOkayButton)};a.prototype.showErrorCloseButton=function(){"use strict";this._errorCloseButton&&b("CSS").show(this._errorCloseButton)};b("mixInEventEmitter")(a,{cancelButtonClicked:!0,retryButtonClicked:!0,dismissPlaceholder:!0});e.exports=a}),null);
__d("XPhotoBatchEditLocationController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/photos/edit/batch/location/",{})}),null);
__d("PhotosBulkEditor",["ix","cx","xuiglyph","ActorURI","Arbiter","AsyncRequest","Button","CSS","DOM","Event","PageTransitions","Parent","PhotosConst","SortableGroup","XPhotoBatchEditLocationController","createIxElement","emptyFunction","mapObject"],(function(a,b,c,d,e,f,g,h,i){__p&&__p();var j={ASCENDING:"ascending",DESCENDING:"descending",MANUAL:"manual"},k={ascending:g("89980"),descending:g("89944")};function l(a,c,d,e,f,g,h,i,j){"use strict";__p&&__p();this.source=a;if(!c)return;this._root=c;this._reorderButton=b("DOM").scry(this._root.parentNode,"button.reorderButton").pop();this._id=c.getAttribute("id");this._ownerID=j;this._photos={};this._tagger=null;this._options=h;this._isNamespaced=i;this._placeholder=f;this._waitingTemplate=g;this._mentionsData=d;this._placesData=e;this._albumPlace=null;this._userDate=null;this._useDateFromFile=!1;this._albumCoverListeners={};this._albumCoverTracksFirstPhoto=this.source===b("PhotosConst").FLASH_UPLOADER;this._coverPhotoSortingID=null;h.canReorder&&this._initSorting(h.autosaveReorder);var k=[b("Arbiter").subscribe(this.mapEventNameToNamespace("PhotosBulkEditablePhoto.INITIALIZED"),this._registerPhoto.bind(this)),b("Arbiter").subscribe([this.mapEventNameToNamespace("PhotosBulkEditablePhoto.REMOVED"),this.mapEventNameToNamespace("PhotosBulkEditablePhoto.ROTATED")],function(a,b){if(this._sortableGroup){a=b.getPhotoData().fbid;this._sortableGroup.removeSortable(a)}delete this._photos[b.getPhotoDataKey()]}.bind(this)),b("Arbiter").subscribe("PhotosBulkEditor.AUTO_ORDER",this._autoOrder.bind(this)),b("Arbiter").subscribe("PhotosBulkBackdateEditor.SAVED",function(a,b){this._useDateFromFile=b.useDateFromFile,this._userDate=b.backdatedDate,this._setDate()}.bind(this)),b("Arbiter").subscribe(["PhotoAlbumPlacesTypeahead.SELECTED_PLACE","PhotoAlbumPlacesTypeahead.EXIST_PLACE","PhotoAlbumPlacesTypeahead.RESET_PLACE"],this._setPlace.bind(this)),b("Arbiter").subscribe("PhotosBulkEditablePhoto.MOVED",function(a,b){this.getPhotoData(b)&&this._photos[b]._doRemove()}.bind(this))];b("Event").listen(this._root,"click",function(a){var c=b("Parent").byClass(a.getTarget(),"editablePhoto"),d=this._photos;b("DOM").scry(this._root,".showControls").forEach(function(a){c!==a&&(b("CSS").removeClass(a,"showControls"),d[a.id].hideMetadataInputs())})}.bind(this));b("PageTransitions").registerHandler(function(){k.forEach(function(a){a.unsubscribe()}),this._tagger&&this._tagger.done()}.bind(this))}l.prototype.init=function(a,b,c,d,e,f){"use strict";l.call(this,this.source,a,b,c,d,e,f)};l.prototype.getRoot=function(){"use strict";return this._root};l.prototype.getSourceString=function(){"use strict";if(this.source===b("PhotosConst").BULK_EDITOR)return"bulk_editor";else if(this.source===b("PhotosConst").FLASH_UPLOADER)return"flash_uploader";else return null};l.prototype.isNamespaced=function(){"use strict";return this._isNamespaced};l.prototype.getVersionConst=function(){"use strict";return this.source};l.prototype.getViewerSource=function(){"use strict";return null};l.prototype.getViewerSet=function(){"use strict";return null};l.prototype.registerTagger=function(a){"use strict";this._tagger=a};l.prototype.needTaggingData=function(){"use strict";return this._tagger&&this._tagger.needTaggingData()};l.prototype.getPhotoData=function(a){"use strict";a=this._photos[a];return a?a.getPhotoData():{}};l.prototype.getPlaceholder=function(){"use strict";return this._placeholder};l.prototype.getWaitingTemplate=function(){"use strict";return this._waitingTemplate};l.prototype.addFaceboxes=function(a){"use strict";this._tagger&&this._tagger.addFaceboxes(a)};l.prototype.mapEventNameToNamespace=function(a){"use strict";return a+(this._isNamespaced?"/"+this._id:"")};l.prototype._registerPhoto=function(event,a){"use strict";__p&&__p();this._setSortMode(j.MANUAL);this._photos[a.getPhotoDataKey()]=a;a.source=this.source;var b=a.getPhotoData(),c=b.fbid;this._sortableGroup&&this._sortableGroup.addSortable(c,a.getRoot(),a.getDragHandle());a.swapData(this._mentionsData,this._placesData);this._sortableGroup&&a.addPlaceSelectHandler(function(){this._sortableGroup.killDrag(c)}.bind(this));this._albumPlace&&!a.hasOwnPlaceValue()&&a.setAlbumPlace(this._albumPlace);this._sortableGroup&&this._albumCoverTracksFirstPhoto&&(this._coverPhotoSortingID=this._sortableGroup.getOrder()[0])};l.prototype._recoverPhotos=function(a){"use strict";a=this._photos;for(var c in a){var d=a[c];this._tagger.recoverPhoto(d);b("CSS").addClass(d.getRoot(),"showRecognitionBoxes");d=b("DOM").find(d.getRoot(),"div.uiScaledImageContainer.scaledImage");this.addFaceboxes(d)}};l.prototype._initSorting=function(a){"use strict";__p&&__p();this._setSortMode(j.MANUAL),this._dropCallback=function(c,d,e){__p&&__p();c=this._photos[d.id].getPhotoData();d={order:this._sortableGroup.getOrder(),owner:c.owner};if(a){var f;c.set?(d.set=c.set,f="/ajax/photos/sets/static/reorder.php"):(d.album_fbid=c.albumFBID,f="/ajax/photos/reorder.php");new(b("AsyncRequest"))(f).setData(d).send()}if(this._sortableGroup&&this._albumCoverTracksFirstPhoto&&this._coverPhotoSortingID!==d.order[0]){c=this._photos[this._sortableGroup.sortables[d.order[0]].id];c&&this._makeAlbumCover(c);this._coverPhotoSortingID=d.order[0]}e||this._setSortMode(j.MANUAL)}.bind(this),this._sortableGroup=new(b("SortableGroup"))().setDropCallback(this._dropCallback).setBeforeGrabCallback(function(){b("Arbiter").inform(this.mapEventNameToNamespace("PhotosBulkEditor.PHOTO_REORDER_START"))}.bind(this))};l.prototype._compare=function(a,b){"use strict";switch(this._sortMode){case j.MANUAL:return this._orderLookup[a.fbid]<this._orderLookup[b.fbid];case j.ASCENDING:return a.timeTaken<b.timeTaken;case j.DESCENDING:return a.timeTaken>b.timeTaken;default:throw new Error("Invalid sort mode")}};l.prototype._setSortMode=function(a){"use strict";if(!this._reorderButton)return;this._sortMode=a;var c=null,d=a!==j.MANUAL;d&&(c=b("createIxElement")(k[a]),b("CSS").addClass(c,"_3-8_"));b("Button").setDepressed(this._reorderButton,d);b("Button").setIcon(this._reorderButton,c)};l.prototype._autoOrder=function(){"use strict";__p&&__p();switch(this._sortMode){case j.MANUAL:var a,c,d=this.getOrder();this._orderLookup={};for(c=0;c<d.length;c++)a=d[c],this._orderLookup[a]=c;this._setSortMode(j.ASCENDING);break;case j.ASCENDING:this._setSortMode(j.DESCENDING);break;case j.DESCENDING:this._setSortMode(j.MANUAL);break;default:throw new Error("Invalid sort mode")}a=this._sortableGroup.getOrder().map(function(a){return this._photos["editablePhoto_"+a].getPhotoData()}.bind(this));this._sortableGroup.setDropCallback(b("emptyFunction"));var e;for(c=0;c<a.length;c++){d=c;for(e=c+1;e<a.length;e++)this._compare(a[e],a[d])&&(d=e);if(c!==d){e=a[d].fbid;var f=a[c].fbid;this._sortableGroup.dragOverHandler(f,e);this._sortableGroup.dropHandler(e);a.splice(c,0,a.splice(d,1)[0])}}f=Object.keys(this._photos)[0];e=this._photos[f];this._dropCallback(e.getPhotoData().fbid,e.getRoot(),!0);this._sortableGroup.setDropCallback(this._dropCallback)};l.prototype._saveCurrentOrder=function(){"use strict";__p&&__p();if(this._photos.length===0)return;var a=this._sortableGroup.getOrder()[0];a=this._photos["editablePhoto_"+a]||this._photos["photoContainer_"+a];if(!a)return;a=a.getPhotoData();if(!a.albumFBID)return;a={order:this._sortableGroup.getOrder(),owner:a.owner,album_fbid:a.albumFBID};new(b("AsyncRequest"))("/ajax/photos/reorder.php").setData(a).send()};l.prototype._setPlace=function(event,a){"use strict";__p&&__p();this._albumPlace=a||null;var c=this._options.batchUpdateLocation,d=[];b("mapObject")(this._photos,function(a,b){if(a.hasOwnPlaceValue())return;a.setAlbumPlace(this._albumPlace,c);c&&d.push(a.getPhotoData().fbid)},this);if(c){a=b("XPhotoBatchEditLocationController").getURIBuilder().getURI();this._ownerID&&(a=b("ActorURI").create(a,this._ownerID));new(b("AsyncRequest"))(a).setData({photo_ids:d,location:this._albumPlace?this._albumPlace.text:"",location_data:this._albumPlace?this._albumPlace.uid:0}).send()}};l.prototype._setDate=function(){"use strict";var a,b=null,c;for(var d in this._photos)c=this._photos[d],this._useDateFromFile||(a=this._userDate.month+"/"+this._userDate.day+"/"+this._userDate.year,b=new Date(a).getTime()),c.setDate(b,!0)};l.prototype._showAlbumCoverSet=function(a){"use strict";this._albumCover&&b("CSS").removeClass(this._albumCover,"checked");a=b("DOM").find(a.getRoot(),".albumCover");b("CSS").addClass(a,"checked");this._albumCover=a};l.prototype._makeAlbumCover=function(a){"use strict";new(b("AsyncRequest"))().setURI("/ajax/photos/album/setcover").setData(a.getPhotoData()).send()};l.prototype.getOrder=function(){"use strict";if(this._sortableGroup)return this._sortableGroup.getOrder();else return[]};l.prototype.hasOrder=function(){"use strict";return!!this._sortableGroup};e.exports=l}),null);
__d("PhotosBulkHeader",["fbt","Arbiter","AsyncRequest","DOM","Event","Form","Run","areJSONRepresentationsEqual","goURI"],(function(a,b,c,d,e,f,g){__p&&__p();function a(a,c,d,e){"use strict";this._form=a,this._isAlbum=c,this._editable=d,this._audience=e,this._backdatedTime=null,this._initialData=null,b("Arbiter").subscribe("PhotosBulkBackdateEditor.SAVED",function(a,c){if(!b("DOM").contains(this._form.getRoot(),c.context))return;this._backdatedTime=c.backdatedDate}.bind(this)),b("Run").onBeforeUnload(function(){return this.isDataDirty()?g._("Some of your changes have not been saved. Would you like to save your changes now?"):!1}.bind(this)),this._initialData=this.getSerializedData()}a.prototype.getSerializedData=function(){"use strict";var a=b("Form").serialize(this._form.getRoot());this._backdatedTime&&(a.backTime=this._backdatedTime);return a};a.prototype.isDataDirty=function(){"use strict";return!b("areJSONRepresentationsEqual")(this._initialData,this.getSerializedData())};a.prototype.save=function(a){"use strict";if(!this._editable)return a.call();this._audience&&this._audience.removeHiddenPrivacyWidget&&this._audience.removeHiddenPrivacyWidget();var c=this._isAlbum?"/ajax/photos/album/edit":"/ajax/photos/sets/edit",d=b("Form").serialize(this._form.getRoot());this._backdatedTime&&(d.backdated_time=this._backdatedTime);new(b("AsyncRequest"))(c).setData(d).setMethod("POST").setHandler(function(){this._initialData=this.getSerializedData(),a()}.bind(this)).send()};a.doneButtonSaveHandler=function(a,c,d){"use strict";var e=a.save.bind(a,function(){b("goURI")(c,!0);return!0});a._listeners=[b("Event").listen(d,"click",e)]};e.exports=a}),null);
__d("TagTypeaheadView",["AsyncRequest","ContextualTypeaheadView","CSS","DOM","FamilyTaggingConfig","Parent"],(function(a,b,c,d,e,f){__p&&__p();var g;c=babelHelpers.inherits(a,b("ContextualTypeaheadView"));g=c&&c.prototype;function a(a,b){"use strict";g.constructor.call(this,a,b),this.hintText=b.hintText,this.userEd=b.userEd,this.origAutoSelect=b.autoSelect,this.setSuggestions(b.suggestions)}a.prototype.init=function(){"use strict";b("CSS").addClass(this.element,"uiTagTypeaheadView"),g.init.call(this)};a.prototype.buildResults=function(a){"use strict";__p&&__p();!this.value&&this.hintText&&a.unshift({subtext:this.hintText,type:"hintText"});this.userEd&&(new(b("AsyncRequest"))().setURI("/ajax/fof/user_education.php").setData({increment:1}).send(),a.unshift({subtext:this.userEd,type:"userEdText"}));if(b("FamilyTaggingConfig").gk){var c=[],d=[];for(var e=0;e<a.length;e++)a[e].type!=="family_tags"&&a[e].index!=-1e3&&a[e].type!=="hintText"?c.push(a[e]):d.push(a[e]);a=d.concat(c);g.updateResults.call(this,a)}e=g.buildResults.call(this,a);this.userEd&&a.shift();this.value||a.shift();return e};a.prototype.show=function(){"use strict";var a=b("DOM").scry(this.context,".typeaheadBackdrop");a.length>0&&b("CSS").addClass(a[0],"resultsPresent");return g.show.call(this)};a.prototype.hide=function(){"use strict";var a=b("DOM").scry(this.context,".typeaheadBackdrop");a.length>0&&b("CSS").removeClass(a[0],"resultsPresent");return g.hide.call(this)};a.prototype.render=function(a,b,c){"use strict";this.autoSelect=this.origAutoSelect&&a.length,this.disableAutoSelect=a.length===0,b=b.concat(this.getAdditionalResults()),g.render.call(this,a,b,c)};a.prototype.getItems=function(){"use strict";var a=g.getItems.call(this);this.value||a.shift();this.userEd&&a.shift();return a};a.prototype.getSuggestions=function(){"use strict";return this.suggestions};a.prototype.setSuggestions=function(a){"use strict";this.suggestions=a?a.map(String):[],this.visible=!!this.suggestions.length};a.prototype.addSuggestion=function(a){"use strict";this.suggestions.unshift(a)};a.prototype.addTypeaheadFlip=function(a){"use strict";b("CSS").addClass(this.element,a)};a.prototype.removeTypeaheadFlip=function(a){"use strict";b("CSS").removeClass(this.element,a)};a.prototype.getContext=function(){"use strict";var a=b("Parent").byClass(this.element,"typeaheadContainer");if(a)return a;else return g.getContext.call(this)};a.prototype.getAdditionalResults=function(){"use strict";return[]};e.exports=a}),null);
__d("PlacesTypeaheadBehavior",["CSS","DOM"],(function(a,b,c,d,e,f){a={init:function(a,c){a.subscribe(["reset","select","highlight"],function(a,d){a==="highlight"&&d.index!==-1&&d.selected.type!="freeform"&&d.selected.map&&!d.selected.changeCity?(b("DOM").setContent(c,d.selected.map),b("CSS").show(c)):b("CSS").hide(c)})}};e.exports=a}),null);
__d("NoTrucatingCompactTypeaheadRenderer",["CompactTypeaheadRenderer"],(function(a,b,c,d,e,f){function a(a,c){return b("CompactTypeaheadRenderer")(a,c)}a.className="noTrucating compact";e.exports=a}),null);
__d("DisablePlatformButton",["CSS","Event","ge"],(function(a,b,c,d,e,f){__p&&__p();var g=!1;a={init:function(a){__p&&__p();for(var c=0;c<a.length;c++){var d=b("ge")(a[c]);b("Event").listen(d,"click",function(c){if(g)return!1;else{g=!0;for(var c=0;c<a.length;c++)b("CSS").addClass(a[c],"uiButtonDisabled")}})}}};e.exports=a}),null);
__d("FreeformTokenizerBehavior",["Event","Input","Keys"],(function(a,b,c,d,e,f){__p&&__p();function a(a,c){__p&&__p();var d=c.matcher&&new RegExp(c.matcher,"i"),e=c.splitter&&new RegExp(c.splitter),f=c.tokenize_on_blur!==!1,g=c.tokenize_on_paste!==!1,h=c.split_on_check===!0,i=c.select_on_comma!==!1,j=c.select_on_space===!0,k=c.never_submit===!0;function l(event){__p&&__p();var c=b("Input").getValue(a.getInput()).trim();e&&event&&event.type=="paste"?c=c.split(e):e&&h?c=c.split(e):c=[c];var f=!1;for(var g=0;g<c.length;g++){var i=c[g].trim();if(i&&(!d||d.test(i))){i={uid:i,text:i,freeform:!0};a.addToken(a.createToken(i));f=!0}}event&&f&&(a.getTypeahead().getCore().afterSelect(),event.kill())}a.subscribe("keydown",function(c,d){var event=d.event;c=b("Event").getKeyCode(event);if(c==b("Keys").RETURN||i&&c==b("Keys").COMMA||j&&c==b("Keys").SPACE){d=a.getTypeahead().getView();d.getSelection()?(d.select(),event.kill()):l(event)}c==b("Keys").RETURN&&k&&event.kill()});a.subscribe("paste",function(a,b){g&&setTimeout(l.bind(null,b.event),20)});a.subscribe("blur",function(b,c){f&&l(),a.getTypeahead().getCore().reset()})}e.exports=a}),null);
__d("TypeaheadHintText",["emptyFunction"],(function(a,b,c,d,e,f){function a(a){"use strict";this._typeahead=a}a.prototype.enable=function(){"use strict";this._typeahead.getCore().resetOnKeyup=!1};Object.assign(a.prototype,{disable:b("emptyFunction")});e.exports=a}),null);
__d("legacy:HintTextTypeaheadBehavior",["TypeaheadHintText"],(function(a,b,c,d,e,f){a.TypeaheadBehaviors||(a.TypeaheadBehaviors={}),a.TypeaheadBehaviors.hintText=function(a){a.enableBehavior(b("TypeaheadHintText"))}}),3);
__d("legacy:ShowResultsOnFocusTypeaheadBehavior",["TypeaheadShowResultsOnFocus"],(function(a,b,c,d,e,f){a.TypeaheadBehaviors||(a.TypeaheadBehaviors={}),a.TypeaheadBehaviors.showResultsOnFocus=function(a){a.enableBehavior(b("TypeaheadShowResultsOnFocus"))}}),3);
__d("ContextualDialogFooterLink",["CSS","DOM","Event"],(function(a,b,c,d,e,f){__p&&__p();function a(a){"use strict";this._layer=a}a.prototype.enable=function(){"use strict";var a=this._layer.getRoot(),c=b("DOM").scry(a,".uiContextualDialogFooterLink")[0],d="uiContextualDialogHoverFooterArrow";this._subscriptions=[b("Event").listen(c,"mouseenter",b("CSS").addClass.bind(null,a,d)),b("Event").listen(c,"mouseleave",b("CSS").removeClass.bind(null,a,d))]};a.prototype.disable=function(){"use strict";this._subscriptions.forEach(function(a){a.remove()}),this._subscriptions=null};Object.assign(a.prototype,{_subscriptions:null});e.exports=a}),null);
__d("getLegacyContextualDialogInstance",["DataStore","Parent"],(function(a,b,c,d,e,f){function a(a){var c=b("DataStore").get(a,"LegacyContextualDialog");if(!c){a=b("Parent").byClass(a,"uiOverlay");a&&(c=b("DataStore").get(a,"overlay"))}return c}e.exports=a}),null);
__d("LegacyContextualDialog",["csx","Arbiter","ArbiterMixin","ARIA","Bootloader","ContextualDialogFooterLink","ContextualThing","CSS","DataStore","DOM","Event","FBLogger","LayerAutoFocus","LayerRefocusOnHide","Locale","Overlay","Parent","Scroll","Style","Vector","$","getLegacyContextualDialogInstance","getOrCreateDOMID","getOverlayZIndex","shield"],(function(a,b,c,d,e,f,g){__p&&__p();var h,i;h=babelHelpers.inherits(j,b("Overlay"));i=h&&h.prototype;j.prototype._configure=function(a,c){"use strict";__p&&__p();i._configure.call(this,a,c);var d=this.getRoot(),e=b("DataStore").get.bind(null,d);this.setAlignH(e("alignh","left"));this.setOffsetX(e("offsetx",0));this.setOffsetY(e("offsety",0));this.setPosition(e("position","above"));this._hasFooter=e("hasfooter",!1);if(this._hasFooter){a=b("DOM").scry(d,".uiContextualDialogFooterLink")[0];a&&this.enableBehavior(b("ContextualDialogFooterLink"))}this.enableBehaviors(this._getDefaultBehaviors());this._setContextSubscription=this.subscribe("beforeshow",function(){this.unsubscribe(this._setContextSubscription);this._setContextSubscription=null;var a=e("context");if(a)this.setContext(b("$")(a));else{a=e("contextselector");var c=a?b("DOM").find(document,a):undefined;c?this.setContext(c):b("FBLogger")("LegacyContextualDialog").mustfix("context doesn't exist in the document: %s",a)}}.bind(this));this._content=b("DOM").scry(d,".uiContextualDialogContent")[0];if(this._content){this._content.setAttribute("role","dialog");c=b("DOM").scry(this._content,".legacyContextualDialogTitle")[0];c&&this._content.setAttribute("aria-labelledby",b("getOrCreateDOMID")(c))}this._showSubscription=this.subscribe("show",function(){var a=b("shield")(this.updatePosition,this);this._resizeListener=b("Event").listen(window,"resize",a);this._reflowSubscription=b("Arbiter").subscribe("reflow",a);this._setupScrollListener(this._scrollParent);b("ContextualThing").register(d,this.context);b("Arbiter").inform("layer_shown",{type:"ContextualDialog"})}.bind(this));this._hideSubscription=this.subscribe("hide",function(){this._teardownResizeAndReflowListeners(),this._teardownScrollListener(),b("Arbiter").inform("layer_hidden",{type:"ContextualDialog"})}.bind(this));return this};j.prototype._getDefaultBehaviors=function(){"use strict";return i._getDefaultBehaviors.call(this).concat([b("LayerAutoFocus"),b("LayerRefocusOnHide")])};j.prototype._buildWrapper=function(a,c){"use strict";a=i._buildWrapper.call(this,a,c);if(!this._shouldBuildWrapper)return a;b("CSS").addClass(a,"uiContextualDialog");return b("DOM").create("div",{className:"uiContextualDialogPositioner"},a)};j.prototype.setWidth=function(a){"use strict";this._width=Math.floor(a);return this};j.prototype.setFixed=function(a){"use strict";a=!!a;b("CSS").conditionClass(this.getRoot(),"uiContextualDialogFixed",a);this._fixed=a;return this};j.prototype.setAlignH=function(a){"use strict";this.alignH=a;this._updateAlignmentClass();this._shown&&this.updatePosition();this.position&&this._updateArrow();return this};j.prototype.getContent=function(){"use strict";return this._content};j.prototype.getContext=function(){"use strict";return this.context};j.prototype.setContext=function(a){"use strict";__p&&__p();this._setContextSubscription&&(this.unsubscribe(this._setContextSubscription),this._setContextSubscription=null);a=b("$")(a);this.context&&this.context!=a&&b("DataStore").remove(this.context,"LegacyContextualDialog");this.context=a;b("ARIA").setPopup(this.getCausalElement(),this.getRoot());var c=b("Parent").bySelector(a,"._4d3w");this.setInsertParent(c||document.body);this._scrollListener&&this._scrollParent!==c&&(this._teardownScrollListener(),this._setupScrollListener(c));this._scrollParent=c;c=b("getOverlayZIndex")(a,this._insertParent);b("Style").set(this.getRoot(),"z-index",c>200?c:"");b("DataStore").set(this.context,"LegacyContextualDialog",this);return this};j.prototype.getCausalElement=function(){"use strict";return i.getCausalElement.call(this)||this.context};j.prototype.listen=function(a,c){"use strict";return b("Event").listen(this.getRoot(),a,c)};j.prototype.setOffsetX=function(a){"use strict";this.offsetX=parseInt(a,10)||0;this._shown&&this.updatePosition();return this};j.prototype.setOffsetY=function(a){"use strict";this.offsetY=parseInt(a,10)||0;this._shown&&this.updatePosition();return this};j.prototype.setPosition=function(a){"use strict";this.position=a;for(var c in j.POSITION_TO_CLASS)b("CSS").conditionClass(this.getRoot(),j.POSITION_TO_CLASS[c],a==c);this._updateAlignmentClass();this._shown&&this.updatePosition();this._updateArrow();return this};j.prototype.updatePosition=function(){"use strict";__p&&__p();if(!this.context)return!1;this._width&&b("Style").set(this._overlay,"width",this._width+"px");var a=this._fixed?"viewport":"document";a=b("Vector").getElementPosition(this.context,a);var c=this._scrollParent;c&&(a=a.sub(b("Vector").getElementPosition(c,"document")).add(b("Scroll").getLeft(c),b("Scroll").getTop(c)));c=b("Vector").getElementDimensions(this.context);var d=this.position=="above"||this.position=="below",e=b("Locale").isRTL();(this.position=="right"||d&&this.alignH=="right")!=e&&(a=a.add(c.x,0));this.position=="below"&&(a=a.add(0,c.y));var f=new(b("Vector"))(0,0);if(d&&this.alignH=="center")f=f.add((c.x-this._width)/2,0);else{c=d?c.x:c.y;var g=2*j.ARROW_INSET;if(c<g){g=c/2-j.ARROW_INSET;d&&this.alignH=="right"!=e&&(g=-g);f=f.add(d?g:0,d?0:g)}}f=f.add(this.offsetX,this.offsetY);e&&(f=f.mul(-1,1));a=a.add(f);this._fixed&&(a=new(b("Vector"))(a.x,a.y,"document"));a.setElementPosition(this.getRoot());this._adjustVerticalPosition();this._adjustHorizontalPosition();return!0};j.prototype.scrollTo=function(){"use strict";this.context&&b("Bootloader").loadModules(["DOMScroll"],function(a){a.scrollTo(this.context,!0,!0)}.bind(this),"LegacyContextualDialog")};j.prototype.destroy=function(){"use strict";this.unsubscribe(this._showSubscription),this.unsubscribe(this._hideSubscription),this._setContextSubscription&&(this.unsubscribe(this._setContextSubscription),this._setContextSubscription=null),this._teardownScrollListener(),this._teardownResizeAndReflowListeners(),this.context&&b("DataStore").remove(this.context,"LegacyContextualDialog"),i.destroy.call(this)};j.prototype._adjustVerticalPosition=function(){"use strict";__p&&__p();if(this.position!="left"&&this.position!="right"){b("Style").set(this._overlay,"top","");return}var a=this.getRoot();a=b("Vector").getElementPosition(a,"viewport").y;var c=b("Vector").getElementDimensions(this._overlay).y,d=b("Vector").getViewportDimensions().y,e=Math.min(Math.max(a,j.MIN_TOP_GAP),j.TOP_MARGIN);d=Math.min(Math.max(0,a+c+j.BOTTOM_MARGIN-d),Math.max(-e,a-e),c-2*j.ARROW_INSET);b("Style").set(this._overlay,"top",-1*d+"px");b("Style").set(this._arrow,"top",j.ARROW_OFFSET+"px");b("Style").set(this._arrow,"marginTop",d+"px")};j.prototype._adjustHorizontalPosition=function(){"use strict";__p&&__p();if(this.position!="above"&&this.position!="below"||this.alignH!="left"){b("Style").set(this._overlay,"left","");b("Style").set(this._overlay,"right","");return}var a=this.getRoot();a=b("Vector").getElementPosition(a,"viewport").x;var c=b("Vector").getElementDimensions(this._overlay).x,d=b("Vector").getViewportDimensions().x,e=b("Locale").isRTL();!e?d=a+c+j.RIGHT_MARGIN-d:d=j.LEFT_MARGIN+c-a;d=Math.min(Math.max(0,d),c-2*j.ARROW_INSET);b("Style").set(this._overlay,e?"right":"left",-1*d+"px");b("Style").set(this._arrow,e?"right":"left",j.ARROW_OFFSET+"px");b("Style").set(this._arrow,e?"marginRight":"marginLeft",d+"px")};j.prototype._updateArrow=function(){"use strict";var a=0;if(this.position=="above"||this.position=="below")switch(this.alignH){case"center":a=50;break;case"right":a=100;break}this._renderArrow(j.POSITION_TO_ARROW[this.position],a)};j.prototype._renderArrow=function(a,c){"use strict";__p&&__p();for(var d in j.ARROW_CLASS)b("CSS").conditionClass(this._overlay,j.ARROW_CLASS[d],a==d);b("CSS").conditionClass(this._overlay,"uiContextualDialogWithFooterArrowBottom",a=="bottom"&&this._hasFooter);if(a=="none")return;this._arrow||(this._arrow=b("DOM").create("i",{className:"uiContextualDialogArrow"}),b("DOM").appendContent(this._overlay,this._arrow));b("Style").set(this._arrow,"top","");b("Style").set(this._arrow,"left","");b("Style").set(this._arrow,"right","");b("Style").set(this._arrow,"margin","");a=a=="top"||a=="bottom";a=a?b("Locale").isRTL()?"right":"left":"top";c=c||0;b("Style").set(this._arrow,a,c+"%");var e=j.ARROW_LENGTH+j.ARROW_OFFSET*2;e=-(e*c/100-j.ARROW_OFFSET);b("Style").set(this._arrow,"margin-"+a,e+"px")};j.prototype._updateAlignmentClass=function(){"use strict";b("CSS").conditionClass(this.getRoot(),j.RIGHT_ALIGNED_CLASS,(this.position=="above"||this.position=="below")&&this.alignH=="right")};j.prototype._setupScrollListener=function(a){"use strict";this._scrollListener=b("Event").listen(a||window,"scroll",b("shield")(this._adjustVerticalPosition,this))};j.prototype._teardownScrollListener=function(){"use strict";this._scrollListener&&(this._scrollListener.remove(),this._scrollListener=null)};j.prototype._teardownResizeAndReflowListeners=function(){"use strict";this._resizeListener&&(this._resizeListener.remove(),this._resizeListener=null),this._reflowSubscription&&(this._reflowSubscription.unsubscribe(),this._reflowSubscription=null)};j.getInstance=function(a){"use strict";return b("getLegacyContextualDialogInstance")(a)};function j(){"use strict";h.apply(this,arguments)}Object.assign(j,b("ArbiterMixin"),{ARROW_OFFSET:15,ARROW_LENGTH:16,ARROW_INSET:22,TOP_MARGIN:50,BOTTOM_MARGIN:30,LEFT_MARGIN:15,RIGHT_MARGIN:30,MIN_TOP_GAP:5,POSITION_TO_CLASS:{above:"uiContextualDialogAbove",below:"uiContextualDialogBelow",left:"uiContextualDialogLeft",right:"uiContextualDialogRight"},RIGHT_ALIGNED_CLASS:"uiContextualDialogRightAligned",ARROW_CLASS:{bottom:"uiContextualDialogArrowBottom",top:"uiContextualDialogArrowTop",right:"uiContextualDialogArrowRight",left:"uiContextualDialogArrowLeft"},POSITION_TO_ARROW:{above:"bottom",below:"top",left:"right",right:"left"}});Object.assign(j.prototype,{_scrollListener:null,_scrollParent:null,_width:null,_fixed:!1,_hasFooter:!1,_showSubscription:null,_hideSubscription:null,_setContextSubscription:null,_resizeListener:null,_reflowSubscription:null});e.exports=j}),null);