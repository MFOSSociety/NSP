if (self.CavalryLogger) { CavalryLogger.start_js(["GSu6a"]); }

__d("CurationCaretNux",["csx","cx","Arbiter","AsyncRequest","CSS","DataStore","DOM","Event","NavigationMessage","Parent","Rect","ge","tidyEvent"],(function(a,b,c,d,e,f,g,h){__p&&__p();var i="div._1zpr",j="div._6ks",k="._3x-2 img.img",l="span.text_exposed_link",m="_5jmm",n="CurationCaretNux_instance",o="CurationCaretNux_caretMenuLoaded",p=100,q="LINK_WELCOME",r="VIDEO_WELCOME",s="POST_SAVE_WELCOME",t="PHOTO_WELCOME",u="caret_nux",v="save_option_nux",w="seen",x="dismissed",y="focus",z="click",A="scroll",B=!1,C=null,D=null;function a(a,c,d,e,f,g){"use strict";__p&&__p();e=b("ge")(e);if(e){this.container=e;this.caret=d;this.caretNux=a.instance;this.caretNuxData=a;this.saveOptionNux=c.instance;this.saveOptionNuxData=c;this.allowAutoplayNux=g;this.popoverTriggered=!1;d=b("Parent").byClass(e,m);b("DataStore").set(d,n,this);switch(f){case q:this.$1();break;case r:this.$1();this.$2();this.$3();break;case s:this.$4();break;case t:this.$5();break}b("Arbiter").subscribeOnce(b("NavigationMessage").NAVIGATION_BEGIN,function(){this.caretNux&&this.caretNux.hide(),this.saveOptionNux&&this.saveOptionNux.hide()}.bind(this))}}a.prototype.$1=function(){"use strict";__p&&__p();var a=b("DOM").scry(this.container,i);a.length>0&&b("tidyEvent")([b("Event").listen(a[0],"click",function(){__p&&__p();if(B||this.videoPlaying)return;this.caretNux.subscribe("show",function(){this.$6()}.bind(this));this.caretNux.subscribe("hide",function(){this.$7(),B&&(this.$8(u,w),this.$8(u,x))}.bind(this));this.$9();this.interactionTime=0;setTimeout(function(){this.$10()||(B=!0,this.caretNux.show())}.bind(this),this.caretNuxData.min_consume_duration);setTimeout(function(){this.$10()||(B=!1,this.caretNux.hide())}.bind(this),this.caretNuxData.max_consume_duration);var a=Date.now();setTimeout(function(){this.$11(function(){this.interactionTime||(this.interactionTime=Date.now()-a)}.bind(this))}.bind(this),0)}.bind(this))])};a.prototype.$2=function(){"use strict";var a=b("DOM").scry(this.container,j);a.length>0&&b("tidyEvent")([b("Event").listen(a[0],"click",function(){this.videoPlaying=!0}.bind(this))])};a.prototype.$3=function(){"use strict";__p&&__p();if(!this.allowAutoplayNux)return;D===null&&(D=this.caretNuxData.min_consume_duration);C===null&&!B&&(C=b("Arbiter").subscribe("flash/updateStatus",function(event,a){if(!B&&D!==null&&a.position*1e3>D){a=b("Parent").byClass(b("ge")(a.divID),m);a=b("DataStore").get(a,n);a&&(B=!0,a.caretNux.show(),a.$6(),b("Arbiter").unsubscribe(C))}}))};a.prototype.$4=function(){"use strict";var a=b("DOM").scry(this.container,l);a.length>0&&b("tidyEvent")([b("Event").listen(a[0],"click",function(){if(B)return;B=!0;this.caretNux.show();this.$6()}.bind(this))])};a.prototype.$5=function(){"use strict";__p&&__p();var a=b("DOM").scry(this.container,k);a.forEach(function(a){__p&&__p();a=b("Parent").byTag(a,"a");if(!a)return;b("Event").listen(a,"click",function(){if(B)return;var a=b("Arbiter").subscribe("PhotoSnowlift.OPEN",function(){var c=Date.now(),d=b("Arbiter").subscribe("PhotoSnowlift.CLOSE",function(){var a=Date.now()-c;a>this.caretNuxData.min_consume_duration&&a<this.caretNuxData.max_consume_duration&&(B=!0,this.caretNux.show(),this.$6());b("Arbiter").unsubscribe(d)}.bind(this));b("Arbiter").unsubscribe(a)}.bind(this))}.bind(this))},this)};a.prototype.$10=function(){"use strict";return this.interactionTime&&this.interactionTime>0};a.prototype.$6=function(){"use strict";__p&&__p();this.caretClickListener=b("Event").listen(this.caret,"click",function(){this.caretNux.hide(),this.saveOptionNux&&(this.popoverTriggered=!0,this.$12())}.bind(this));var a=!1,c=function(c){if(a||c===z||!this.caretNux.isShown())return;c=b("Rect").getViewportWithoutScrollbarsBounds();var d=b("Rect").getElementBounds(this.caretNux.getContentRoot());d=d.sub(0,p);c.contains(d)&&(this.$8(u,w),a=!0)}.bind(this);c();this.$9();this.$11(c)};a.prototype.$7=function(){"use strict";this.caretClickListener.remove(),this.$13()};a.prototype.$12=function(){"use strict";__p&&__p();this.$14()&&this.popoverTriggered&&setTimeout(function(){__p&&__p();var a=b("DOM").scry(document,"li.save_caret_menu_item");for(var c=0;c<a.length;c++){var d=a[c],e=b("Parent").byClass(d,"uiLayer");if(e&&b("CSS").shown(e)){this.saveOptionNux.setContext(d);break}}this.saveOptionNux.show();this.$8(v,w);e=b("DataStore").get(this.caret,"Popover");e&&e.subscribeOnce("hide",function(){this.saveOptionNux.hide()}.bind(this))}.bind(this),0)};a.prototype.$8=function(a,c){"use strict";__p&&__p();var d;if(a===u)d=this.caretNuxData;else if(a===v)d=this.saveOptionNuxData;else throw new Error("Invalid nux type");var e;if(c===w)e=d.seen_uri,d.seen_uri=null;else if(c===x)e=d.dismiss_uri,d.dismiss_uri=null;else throw new Error("Invalid impression type");if(e){c=new(b("AsyncRequest"))(e);this.interactionTime&&a===u&&c.setData({interaction_time:this.interactionTime});c.send()}};a.prototype.$11=function(a){"use strict";this.$15.push(a)};a.prototype.$16=function(a){"use strict";this.$15.forEach(function(b){b.call(this,a)},this)};a.prototype.$9=function(){"use strict";this.$17||(this.$15=[],this.$17=[b("Event").listen(window,"click",this.$16.bind(this,z)),b("Event").listen(window,"focus",this.$16.bind(this,y)),b("Event").listen(window,"scroll",this.$16.bind(this,A))])};a.prototype.$13=function(a){"use strict";if(this.$17){while(this.$17.length)this.$17.pop().remove();this.$17=null;this.$15=null}};a.prototype.$14=function(){"use strict";var a=b("Parent").byClass(this.container,m);return b("DataStore").get(a,o)===!0};a.saveOptionLoaded=function(a){"use strict";__p&&__p();a=b("ge")(a);if(a){a=b("Parent").byClass(a,m);if(a){b("DataStore").set(a,o,!0);a=b("DataStore").get(a,n);a&&a.$12()}}};e.exports=a}),null);
__d("SaveState",[],(function(a,b,c,d,e,f){a=Object.freeze({SAVING:"saving",SAVED:"saved",UNSAVING:"unsaving",UNSAVED:"unsaved"});e.exports=a}),null);
__d("SaveStateHandler",["Run","SaveState"],(function(a,b,c,d,e,f){__p&&__p();var g=null;function h(){"use strict";this.$1={},this.$2={},b("Run").onLeave(function(){g=null})}h.prototype.addListener=function(a,b){"use strict";this.$1[a]||(this.$1[a]=[]),this.$1[a].push(b)};h.prototype.setState=function(a,b){"use strict";a.forEach(function(a){this.$2[a]=b;if(!this.$1[a])return;a=this.$1[a];a.forEach(function(a){try{a.call(window,b)}catch(a){}})},this)};h.prototype.getState=function(a){"use strict";return this.$2[a]};h.$3=function(){"use strict";g||(g=new h());return g};h.listen=function(a,b){"use strict";this.$3().addListener(a,b)};h.getState=function(a){"use strict";this.$3().getState(a)};h.saving=function(a){"use strict";this.$3().setState(a,b("SaveState").SAVING)};h.saved=function(a){"use strict";this.$3().setState(a,b("SaveState").SAVED)};h.unsaving=function(a){"use strict";this.$3().setState(a,b("SaveState").UNSAVING)};h.unsaved=function(a){"use strict";this.$3().setState(a,b("SaveState").UNSAVED)};h.isSaveAction=function(a){"use strict";a=this.$3().getState(a);return a==b("SaveState").UNSAVED||a==b("SaveState").UNSAVING};e.exports=h}),null);
__d("CurationToggleButton",["cx","CSS","Event","SaveState","SaveStateHandler","tidyEvent"],(function(a,b,c,d,e,f,g){__p&&__p();var h="_vu",i="_vv";function a(a,c,d,e,f){"use strict";__p&&__p();this.$1=!1,this.$2=f,b("tidyEvent")([b("Event").listen(c,"click",this.setSaving.bind(this)),b("Event").listen(c,"error",this.setUnsaved.bind(this)),b("Event").listen(d,"click",this.setUnsaving.bind(this)),b("Event").listen(d,"error",this.setSaved.bind(this))]),b("SaveStateHandler").listen(e,function(e){__p&&__p();switch(e){case b("SaveState").SAVING:b("CSS").addClass(a,h);b("CSS").addClass(a,i);d.setAttribute("rel","");this.$1=!0;break;case b("SaveState").SAVED:b("CSS").addClass(a,h);b("CSS").removeClass(a,i);d.setAttribute("rel","async-post");this.$1=!1;break;case b("SaveState").UNSAVING:b("CSS").removeClass(a,h);b("CSS").addClass(a,i);c.setAttribute("rel","");this.$1=!0;break;case b("SaveState").UNSAVED:b("CSS").removeClass(a,h);b("CSS").removeClass(a,i);c.setAttribute("rel","async-post");this.$1=!1;break}}.bind(this))}a.prototype.setSaving=function(){"use strict";this.$1||b("SaveStateHandler").saving(this.$2)};a.prototype.setUnsaving=function(){"use strict";this.$1||b("SaveStateHandler").unsaving(this.$2)};a.prototype.setSaved=function(){"use strict";b("SaveStateHandler").saved(this.$2)};a.prototype.setUnsaved=function(){"use strict";b("SaveStateHandler").unsaved(this.$2)};e.exports=a}),null);
__d("XSavedForLaterNUXSeenController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/saved/nuxseen/",{action:{type:"Enum",enumType:1},surface:{type:"Enum",enumType:1},mechanism:{type:"Enum",enumType:1},collection_id:{type:"Enum",enumType:0},object_id:{type:"Int"},interaction_time:{type:"Int"}})}),null);