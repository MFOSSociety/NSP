{% extends 'base.html' %}
{% load static %}
{% block head %}
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <link href='https://fonts.googleapis.com/css?family=Montserrat' rel='stylesheet'>
    <!-- Add icon library -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="{% static 'accounts/css/style.css' %}">
{% endblock %}
{% block body %}
    <div class="site-wrapper" style="margin-top:75px;">

        <br>
        <div class="container">
            <div class="row lead mb-7">
                <div class="col-md-5 ">
                    <div class="container first">
                        {% if user.userprofile.gender == 'Male' %}
                            <h2>Mr. {{ user.first_name }} {{ user.last_name }}</h2>
                        {% elif user.userprofile.gender == 'Female' %}
                            <h2>Ms. {{ user.first_name }} {{ user.last_name }}</h2>
                        {% else %}
                            <h2>{{ user.first_name }} {{ user.last_name }}</h2>
                        {% endif %}
                        {% if user.userprofile.photo %}
                            <img id="user-profile-pic" class="img-thumbnail" alt="user image" src="{{ user.userprofile.photo.url }}"
                                 width="240">
                        {% else %}
                            <img id="user-profile-pic" class="img-thumbnail" alt="user image"
                                 src="{% static 'accounts/img/nsp_profile_default.jpg' %}" width="240px">
                        {% endif %}
                        <br/>
                        <small id="preview-warning" style="display: none;">This is a preview. Click 'Save picture' below to make it your new profile picture</small>
                        <small class="alert alert-warning" id="pic-save-error" style="display: none;">Could not save the image, please refresh the page and try again</small>

                        <table class="table table-striped " style="margin-left: -40px; width: 300px;">
                            <tr>
                                <td>
                                    <h5>
                                        Username : {{ user.username }}
                                    </h5>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <h5>
                                        <form action="lk" method="post" class="hidden-form" id="profile-pic-form">
                                            {% csrf_token %}
                                            <input type="file" name="profile-picture" id="profile-pic" accept="image/*">
                                        </form>
                                        <div id="save-pic-grid">
                                            <div>
                                                <button type="submit" class="btn btn-dark" id="profile-pic-save">save picture</button>
                                            </div>
                                            <img id="spinner-profile-pic" src="" data-src="{% static 'accounts/img/spinner.gif' %}">
                                        </div>
                                        <button id="profile-pic-upload" class="btn btn-primary" href="{% url 'change_profile_picture' %}" style="width: 100%" onclick="uploadPic()">Upload New Pic</button>
                                    </h5>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <h5>
                                        <!-- <a class="btn btn-primary" href="{% url 'EditDetails' user.id %}" style="width: 100%">Update Info</a> -->
                                        <button id="update-info-btn" class="btn btn-primary" style="width: 100%">Update Info</button>
                                    </h5>   
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <h5>Followers : {{ followers }}</h5>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <h5>Following : {{ following }}</h5>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <h5 id="info-stream">Stream : {{ user.userprofile.stream }}</h5>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <h5 id="info-branch">Branch : {{ user.userprofile.branch }}</h5>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <h5 id="info-year">Year : {{ user.userprofile.year }}</h5>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <h5>Email : {{ user.email }}</h5>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <h5>Ratings :
                                        {% for i in range %}
                                            <i class="fa fa-star" style="color:dodgerblue"></i>
                                        {% endfor %}
                                    </h5>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <h5>
                                        <a class="btn btn-danger" href="{% url 'change_password' %}"
                                           style="width: 100%">Change Password</a>
                                    </h5>
                                </td>
                            </tr>
                        </table>
                        <div id="update-info-now">
                            <div id="modal-title" class="text-center">
                                <div id="modal-title-1"><h2>Update info</h2></div>
                                <div id="modal-close"><button class="btn btn-outline-dark" id="modal-close-button" data-modal-id="update-info-now">close</button></div>
                            </div>
                            <div id="info-update-error" class="alert alert-warning" style="display: none;">
                                Could not update info please refresh the page and try again
                            </div>
                            <form action="uhj" method="post" id="update-info-form" data-modal-id="update-info-now">
                                {% csrf_token %}
                                <div class="grided">
                                    <div class="form-group" id="profile_year">
                                        <label for="">{{ profile_form.year.label }}</label>
                                        <br />
                                        {{ profile_form.year }}
                                    </div>
                                    <div class="form-group" id="profile_branch">
                                        <label for="">{{ profile_form.branch.label }}</label>
                                        <br />
                                        {{ profile_form.branch }}
                                    </div>
                                    <div class="form-group" id="profile_stream">
                                        <label for="">{{ profile_form.stream.label }}</label>
                                        <br />
                                        {{ profile_form.stream }}
                                    </div>
                                    <div class="form-group" id="profile_gender">
                                        <label for="">{{ profile_form.gender.label }}</label>
                                        <br />
                                        {{ profile_form.gender }}
                                    </div>
                                    <div class="form-group" id="profile_position">
                                        <label for="">{{ profile_form.position.label }}</label>
                                        <br />
                                        {{ profile_form.position }}
                                    </div>

                                    <div class="form-group" id="update-submit-button">
                                        <button id="info-submit-button" type="submit" class="btn btn-dark" disabled >update info</button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 " style="margin-top:80px;">
                    <div class=" bg-light">
                        <center>
                            <h2 class="second">BIO</h2>
                            <br>

                            <h5 style="word-break: break-all">
                            {% if user.userprofile.bio|length == 0 %}
                                <div id="bio-div">No bio yet! </div>
                            {% else %}
                                <div id="bio-div">{{ user.userprofile.bio|linebreaks }}</div>
                            {% endif %}
                            <button id="bio-form-toogle" class="btn btn-primary toggle-form"  data-form-id="bio-form" data-og-text="Update bio">Update bio</button>
                            </h5>
                            <form action="" id="bio-form" class="hidden-form">
                                {% csrf_token %}
                                <span id="bio-error" style="display: none;">Could not update bio, please refresh the page and try again</span>
                                <div class="form-group">
                                    <textarea name="user-bio" id="user-bio" cols="30" rows="5" class="form-control">{% if user.userprofile.bio|length > 0 %}{{ user.userprofile.bio }}{% endif %}</textarea>
                                </div>
                                <div class="form-group">
                                    <button id="bio-form-sub" type="submit" class="btn btn-dark" disabled >Update bio</button>
                                </div>
                            </form> 
                            <br>
                        </center>   
                    </div>
                    <br>
                    <div>
                        <center>
                            <div>
                                <h2 class="second">Skills</h2>
                            </div>
                        </center>

                        <div style="text-align: center;" id="all-skills">
                            {% if skills %}
                                {% for skill in skills %}
                                    <div id="skill-{{ skill.pk }}">
                                        <span id="skill-{{ skill.pk }}-del-error" style="display: none;">Could Delete skill, please refresh the page and try again</span>
                                        
                                        <div class="skill-row">
                                            <span class="skill-title">{{ skill }}</span>
                                            <form action="" method="post" class="skill-delete-form">
                                                {% csrf_token %}
                                                <input type="hidden" name="skill-id" class="form-control" value="{{ skill.pk }}">
                                                <span class="fa fa-trash delete-skill" data-form-id="skill-{{ skill.pk }}" data-error-ID="skill-{{ skill.pk }}-del-error"></span>
                                            </form>
                                        </div>
                                        <hr>
                                    </div>
                                {% endfor %}
                            {% else %}
                                <td id="no-skills-div">You haven't added any skills to your profile!</td>
                            {% endif %}
                        </div>
                        <button id="add-skill-toogle" class="btn btn-primary toggle-form" data-form-id="skill-form" data-og-text="Add skill">Add skill</button>
                        <form action="{% url 'addskill' %}" id="skill-form" class="form-inline hidden-form">
                            {% csrf_token %}
                            <span id="skill-error" style='display: none;'>An error occured, please refresh the page and try again</span>
                            <div class="form-group">
                                <input type="text" name="skill" id="skill" placeholder="Add a skill" class="form-control">
                            </div>
                            <div class="form-group">
                                <input type="submit" value="add skill" class="btn btn-dark" disabled>
                            </div>
                        </form>
                    </div>
                    <center>
                        <div>
                            <h2 class="second">Interested in</h2>
                        </div>
                    </center>
                    <table class="table">
                        <thead>
                        </thead>
                        <tbody style="text-align: center;">
                        {% for project in projects %}
                            <tr>
                                <td>
                                    <a href="{% url 'view_project_detail' project.project.id %}">{{ project.project.project_name }}
                                </td>
                                </a>
                            </tr>
                        {% empty %}
                            <tr>
                                <td>You're not interested in any projects right now.</td>
                            </tr>
                            <tr>
                                <td>
                                    <a class="btn btn-warning" href="{% url 'project_list_view' %}" style="width: 100%">Browse
                                        active projects!</a>
                                </td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

{% endblock %}


{% block customjs %}
<script src="{% static 'accounts/js/ajaxWrapper.js' %}"></script>
<script src="{% static 'accounts/js/profile.js' %}"></script>
{% endblock customjs %}